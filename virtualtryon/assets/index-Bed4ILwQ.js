import{r as nt,g as Gt,a as lr}from"./vendor-DDxydHEc.js";import{P as cr,S as dr}from"./mediapipe-iWp-KiSB.js";import{_ as st,a as ur,b as ut}from"./transformers-Bfy1C51G.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var Me={exports:{}},le={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ft;function fr(){if(ft)return le;ft=1;var s=nt(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,d){var f,u={},g=null,h=null;d!==void 0&&(g=""+d),l.key!==void 0&&(g=""+l.key),l.ref!==void 0&&(h=l.ref);for(f in l)r.call(l,f)&&!i.hasOwnProperty(f)&&(u[f]=l[f]);if(a&&a.defaultProps)for(f in l=a.defaultProps,l)u[f]===void 0&&(u[f]=l[f]);return{$$typeof:e,type:a,key:g,ref:h,props:u,_owner:n.current}}return le.Fragment=t,le.jsx=o,le.jsxs=o,le}var gt;function gr(){return gt||(gt=1,Me.exports=fr()),Me.exports}var c=gr(),x=nt();const ge=Gt(x);var Ce={},ht;function hr(){if(ht)return Ce;ht=1;var s=lr();return Ce.createRoot=s.createRoot,Ce.hydrateRoot=s.hydrateRoot,Ce}var pr=hr();const mr=Gt(pr),b=s=>typeof s=="string",ce=()=>{let s,e;const t=new Promise((r,n)=>{s=r,e=n});return t.resolve=s,t.reject=e,t},pt=s=>s==null?"":""+s,xr=(s,e,t)=>{s.forEach(r=>{e[r]&&(t[r]=e[r])})},yr=/###/g,mt=s=>s&&s.indexOf("###")>-1?s.replace(yr,"."):s,xt=s=>!s||b(s),he=(s,e,t)=>{const r=b(e)?e.split("."):e;let n=0;for(;n<r.length-1;){if(xt(s))return{};const i=mt(r[n]);!s[i]&&t&&(s[i]=new t),Object.prototype.hasOwnProperty.call(s,i)?s=s[i]:s={},++n}return xt(s)?{}:{obj:s,k:mt(r[n])}},yt=(s,e,t)=>{const{obj:r,k:n}=he(s,e,Object);if(r!==void 0||e.length===1){r[n]=t;return}let i=e[e.length-1],o=e.slice(0,e.length-1),a=he(s,o,Object);for(;a.obj===void 0&&o.length;)i=`${o[o.length-1]}.${i}`,o=o.slice(0,o.length-1),a=he(s,o,Object),a?.obj&&typeof a.obj[`${a.k}.${i}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${i}`]=t},br=(s,e,t,r)=>{const{obj:n,k:i}=he(s,e,Object);n[i]=n[i]||[],n[i].push(t)},ke=(s,e)=>{const{obj:t,k:r}=he(s,e);if(t&&Object.prototype.hasOwnProperty.call(t,r))return t[r]},vr=(s,e,t)=>{const r=ke(s,t);return r!==void 0?r:ke(e,t)},Vt=(s,e,t)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in s?b(s[r])||s[r]instanceof String||b(e[r])||e[r]instanceof String?t&&(s[r]=e[r]):Vt(s[r],e[r],t):s[r]=e[r]);return s},se=s=>s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var wr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Sr=s=>b(s)?s.replace(/[&<>"'\/]/g,e=>wr[e]):s;class Cr{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const Nr=[" ",",","?","!",";"],Rr=new Cr(20),kr=(s,e,t)=>{e=e||"",t=t||"";const r=Nr.filter(o=>e.indexOf(o)<0&&t.indexOf(o)<0);if(r.length===0)return!0;const n=Rr.getRegExp(`(${r.map(o=>o==="?"?"\\?":o).join("|")})`);let i=!n.test(s);if(!i){const o=s.indexOf(t);o>0&&!n.test(s.substring(0,o))&&(i=!0)}return i},Ve=(s,e,t=".")=>{if(!s)return;if(s[e])return Object.prototype.hasOwnProperty.call(s,e)?s[e]:void 0;const r=e.split(t);let n=s;for(let i=0;i<r.length;){if(!n||typeof n!="object")return;let o,a="";for(let l=i;l<r.length;++l)if(l!==i&&(a+=t),a+=r[l],o=n[a],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&l<r.length-1)continue;i+=l-i+1;break}n=o}return n},me=s=>s?.replace("_","-"),Er={type:"logger",log(s){this.output("log",s)},warn(s){this.output("warn",s)},error(s){this.output("error",s)},output(s,e){console?.[s]?.apply?.(console,e)}};class Ee{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||Er,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,r,n){return n&&!this.debug?null:(b(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new Ee(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new Ee(this.logger,e)}}var J=new Ee;class Te{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const n=this.observers[r].get(t)||0;this.observers[r].set(t,n+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e,...t){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([n,i])=>{for(let o=0;o<i;o++)n(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([n,i])=>{for(let o=0;o<i;o++)n.apply(n,[e,...t])})}}class bt extends Te{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,r,n={}){const i=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,o=n.ignoreJSONStructure!==void 0?n.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;e.indexOf(".")>-1?a=e.split("."):(a=[e,t],r&&(Array.isArray(r)?a.push(...r):b(r)&&i?a.push(...r.split(i)):a.push(r)));const l=ke(this.data,a);return!l&&!t&&!r&&e.indexOf(".")>-1&&(e=a[0],t=a[1],r=a.slice(2).join(".")),l||!o||!b(r)?l:Ve(this.data?.[e]?.[t],r,i)}addResource(e,t,r,n,i={silent:!1}){const o=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let a=[e,t];r&&(a=a.concat(o?r.split(o):r)),e.indexOf(".")>-1&&(a=e.split("."),n=t,t=a[1]),this.addNamespaces(t),yt(this.data,a,n),i.silent||this.emit("added",e,t,r,n)}addResources(e,t,r,n={silent:!1}){for(const i in r)(b(r[i])||Array.isArray(r[i]))&&this.addResource(e,t,i,r[i],{silent:!0});n.silent||this.emit("added",e,t,r)}addResourceBundle(e,t,r,n,i,o={silent:!1,skipCopy:!1}){let a=[e,t];e.indexOf(".")>-1&&(a=e.split("."),n=r,r=t,t=a[1]),this.addNamespaces(t);let l=ke(this.data,a)||{};o.skipCopy||(r=JSON.parse(JSON.stringify(r))),n?Vt(l,r,i):l={...l,...r},yt(this.data,a,l),o.silent||this.emit("added",e,t,r)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(n=>t[n]&&Object.keys(t[n]).length>0)}toJSON(){return this.data}}var Wt={processors:{},addPostProcessor(s){this.processors[s.name]=s},handle(s,e,t,r,n){return s.forEach(i=>{e=this.processors[i]?.process(e,t,r,n)??e}),e}};const Kt=Symbol("i18next/PATH_KEY");function Lr(){const s=[],e=Object.create(null);let t;return e.get=(r,n)=>(t?.revoke?.(),n===Kt?s:(s.push(n),t=Proxy.revocable(r,e),t.proxy)),Proxy.revocable(Object.create(null),e).proxy}function We(s,e){const{[Kt]:t}=s(Lr());return t.join(e?.keySeparator??".")}const vt={},De=s=>!b(s)&&typeof s!="boolean"&&typeof s!="number";class Le extends Te{constructor(e,t={}){super(),xr(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=J.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const r={...t};if(e==null)return!1;const n=this.resolve(e,r);if(n?.res===void 0)return!1;const i=De(n.res);return!(r.returnObjects===!1&&i)}extractFromKey(e,t){let r=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const n=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const o=r&&e.indexOf(r)>-1,a=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!kr(e,r,n);if(o&&!a){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:b(i)?[i]:i};const d=e.split(r);(r!==n||r===n&&this.options.ns.indexOf(d[0])>-1)&&(i=d.shift()),e=d.join(n)}return{key:e,namespaces:b(i)?[i]:i}}translate(e,t,r){let n=typeof t=="object"?{...t}:t;if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),e==null)return"";typeof e=="function"&&(e=We(e,{...this.options,...n})),Array.isArray(e)||(e=[String(e)]);const i=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,o=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:a,namespaces:l}=this.extractFromKey(e[e.length-1],n),d=l[l.length-1];let f=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;f===void 0&&(f=":");const u=n.lng||this.language,g=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u?.toLowerCase()==="cimode")return g?i?{res:`${d}${f}${a}`,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:d,usedParams:this.getUsedParamsDetails(n)}:`${d}${f}${a}`:i?{res:a,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:d,usedParams:this.getUsedParamsDetails(n)}:a;const h=this.resolve(e,n);let p=h?.res;const m=h?.usedKey||a,y=h?.exactUsedKey||a,C=["[object Number]","[object Function]","[object RegExp]"],w=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,D=!this.i18nFormat||this.i18nFormat.handleAsObject,L=n.count!==void 0&&!b(n.count),v=Le.hasDefaultValue(n),_=L?this.pluralResolver.getSuffix(u,n.count,n):"",N=n.ordinal&&L?this.pluralResolver.getSuffix(u,n.count,{ordinal:!1}):"",k=L&&!n.ordinal&&n.count===0,S=k&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${_}`]||n[`defaultValue${N}`]||n.defaultValue;let E=p;D&&!p&&v&&(E=S);const j=De(E),B=Object.prototype.toString.apply(E);if(D&&E&&j&&C.indexOf(B)<0&&!(b(w)&&Array.isArray(E))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const O=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,E,{...n,ns:l}):`key '${a} (${this.language})' returned an object instead of string.`;return i?(h.res=O,h.usedParams=this.getUsedParamsDetails(n),h):O}if(o){const O=Array.isArray(E),M=O?[]:{},R=O?y:m;for(const P in E)if(Object.prototype.hasOwnProperty.call(E,P)){const A=`${R}${o}${P}`;v&&!p?M[P]=this.translate(A,{...n,defaultValue:De(S)?S[P]:void 0,joinArrays:!1,ns:l}):M[P]=this.translate(A,{...n,joinArrays:!1,ns:l}),M[P]===A&&(M[P]=E[P])}p=M}}else if(D&&b(w)&&Array.isArray(p))p=p.join(w),p&&(p=this.extendTranslation(p,e,n,r));else{let O=!1,M=!1;!this.isValidLookup(p)&&v&&(O=!0,p=S),this.isValidLookup(p)||(M=!0,p=a);const P=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&M?void 0:p,A=v&&S!==p&&this.options.updateMissing;if(M||O||A){if(this.logger.log(A?"updateKey":"missingKey",u,d,a,A?S:p),o){const T=this.resolve(a,{...n,keySeparator:!1});T&&T.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let H=[];const z=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&z&&z[0])for(let T=0;T<z.length;T++)H.push(z[T]);else this.options.saveMissingTo==="all"?H=this.languageUtils.toResolveHierarchy(n.lng||this.language):H.push(n.lng||this.language);const F=(T,G,X)=>{const we=v&&X!==p?X:P;this.options.missingKeyHandler?this.options.missingKeyHandler(T,d,G,we,A,n):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(T,d,G,we,A,n),this.emit("missingKey",T,d,G,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&L?H.forEach(T=>{const G=this.pluralResolver.getSuffixes(T,n);k&&n[`defaultValue${this.options.pluralSeparator}zero`]&&G.indexOf(`${this.options.pluralSeparator}zero`)<0&&G.push(`${this.options.pluralSeparator}zero`),G.forEach(X=>{F([T],a+X,n[`defaultValue${X}`]||S)})}):F(H,a,S))}p=this.extendTranslation(p,e,n,h,r),M&&p===a&&this.options.appendNamespaceToMissingKey&&(p=`${d}${f}${a}`),(M||O)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${d}${f}${a}`:a,O?p:void 0,n))}return i?(h.res=p,h.usedParams=this.getUsedParamsDetails(n),h):p}extendTranslation(e,t,r,n,i){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const l=b(e)&&(r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(l){const u=e.match(this.interpolator.nestingRegexp);d=u&&u.length}let f=r.replace&&!b(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(f={...this.options.interpolation.defaultVariables,...f}),e=this.interpolator.interpolate(e,f,r.lng||this.language||n.usedLng,r),l){const u=e.match(this.interpolator.nestingRegexp),g=u&&u.length;d<g&&(r.nest=!1)}!r.lng&&n&&n.res&&(r.lng=this.language||n.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,(...u)=>i?.[0]===u[0]&&!r.context?(this.logger.warn(`It seems you are nesting recursively key: ${u[0]} in key: ${t[0]}`),null):this.translate(...u,t),r)),r.interpolation&&this.interpolator.reset()}const o=r.postProcess||this.options.postProcess,a=b(o)?[o]:o;return e!=null&&a?.length&&r.applyPostProcessor!==!1&&(e=Wt.handle(a,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e,t={}){let r,n,i,o,a;return b(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(r))return;const d=this.extractFromKey(l,t),f=d.key;n=f;let u=d.namespaces;this.options.fallbackNS&&(u=u.concat(this.options.fallbackNS));const g=t.count!==void 0&&!b(t.count),h=g&&!t.ordinal&&t.count===0,p=t.context!==void 0&&(b(t.context)||typeof t.context=="number")&&t.context!=="",m=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);u.forEach(y=>{this.isValidLookup(r)||(a=y,!vt[`${m[0]}-${y}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(a)&&(vt[`${m[0]}-${y}`]=!0,this.logger.warn(`key "${n}" for languages "${m.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),m.forEach(C=>{if(this.isValidLookup(r))return;o=C;const w=[f];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(w,f,C,y,t);else{let L;g&&(L=this.pluralResolver.getSuffix(C,t.count,t));const v=`${this.options.pluralSeparator}zero`,_=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(g&&(t.ordinal&&L.indexOf(_)===0&&w.push(f+L.replace(_,this.options.pluralSeparator)),w.push(f+L),h&&w.push(f+v)),p){const N=`${f}${this.options.contextSeparator||"_"}${t.context}`;w.push(N),g&&(t.ordinal&&L.indexOf(_)===0&&w.push(N+L.replace(_,this.options.pluralSeparator)),w.push(N+L),h&&w.push(N+v))}}let D;for(;D=w.pop();)this.isValidLookup(r)||(i=D,r=this.getResource(C,y,D,t))}))})}),{res:r,usedKey:n,exactUsedKey:i,usedLng:o,usedNS:a}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,r,n={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,r,n):this.resourceStore.getResource(e,t,r,n)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!b(e.replace);let n=r?e.replace:e;if(r&&typeof e.count<"u"&&(n.count=e.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!r){n={...n};for(const i of t)delete n[i]}return n}static hasDefaultValue(e){const t="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t===r.substring(0,t.length)&&e[r]!==void 0)return!0;return!1}}class wt{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=J.create("languageUtils")}getScriptPartFromCode(e){if(e=me(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=me(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(b(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(r=>{if(t)return;const n=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(n))&&(t=n)}),!t&&this.options.supportedLngs&&e.forEach(r=>{if(t)return;const n=this.getScriptPartFromCode(r);if(this.isSupportedCode(n))return t=n;const i=this.getLanguagePartFromCode(r);if(this.isSupportedCode(i))return t=i;t=this.options.supportedLngs.find(o=>{if(o===i)return o;if(!(o.indexOf("-")<0&&i.indexOf("-")<0)&&(o.indexOf("-")>0&&i.indexOf("-")<0&&o.substring(0,o.indexOf("-"))===i||o.indexOf(i)===0&&i.length>1))return o})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),b(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}toResolveHierarchy(e,t){const r=this.getFallbackCodes((t===!1?[]:t)||this.options.fallbackLng||[],e),n=[],i=o=>{o&&(this.isSupportedCode(o)?n.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return b(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):b(e)&&i(this.formatLanguageCode(e)),r.forEach(o=>{n.indexOf(o)<0&&i(this.formatLanguageCode(o))}),n}}const St={zero:0,one:1,two:2,few:3,many:4,other:5},Ct={select:s=>s===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class jr{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=J.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const r=me(e==="dev"?"en":e),n=t.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:r,type:n});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let o;try{o=new Intl.PluralRules(r,{type:n})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Ct;if(!e.match(/-|_/))return Ct;const l=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(l,t)}return this.pluralRulesCache[i]=o,o}needsPlural(e,t={}){let r=this.getRule(e,t);return r||(r=this.getRule("dev",t)),r?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,r={}){return this.getSuffixes(e,r).map(n=>`${t}${n}`)}getSuffixes(e,t={}){let r=this.getRule(e,t);return r||(r=this.getRule("dev",t)),r?r.resolvedOptions().pluralCategories.sort((n,i)=>St[n]-St[i]).map(n=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${n}`):[]}getSuffix(e,t,r={}){const n=this.getRule(e,r);return n?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${n.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,r))}}const Nt=(s,e,t,r=".",n=!0)=>{let i=vr(s,e,t);return!i&&n&&b(t)&&(i=Ve(s,t,r),i===void 0&&(i=Ve(e,t,r))),i},$e=s=>s.replace(/\$/g,"$$$$");class Pr{constructor(e={}){this.logger=J.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(t=>t),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:r,useRawValueToEscape:n,prefix:i,prefixEscaped:o,suffix:a,suffixEscaped:l,formatSeparator:d,unescapeSuffix:f,unescapePrefix:u,nestingPrefix:g,nestingPrefixEscaped:h,nestingSuffix:p,nestingSuffixEscaped:m,nestingOptionsSeparator:y,maxReplaces:C,alwaysFormat:w}=e.interpolation;this.escape=t!==void 0?t:Sr,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=n!==void 0?n:!1,this.prefix=i?se(i):o||"{{",this.suffix=a?se(a):l||"}}",this.formatSeparator=d||",",this.unescapePrefix=f?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":f||"",this.nestingPrefix=g?se(g):h||se("$t("),this.nestingSuffix=p?se(p):m||se(")"),this.nestingOptionsSeparator=y||",",this.maxReplaces=C||1e3,this.alwaysFormat=w!==void 0?w:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,r)=>t?.source===r?(t.lastIndex=0,t):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,t,r,n){let i,o,a;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},d=h=>{if(h.indexOf(this.formatSeparator)<0){const C=Nt(t,l,h,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(C,void 0,r,{...n,...t,interpolationkey:h}):C}const p=h.split(this.formatSeparator),m=p.shift().trim(),y=p.join(this.formatSeparator).trim();return this.format(Nt(t,l,m,this.options.keySeparator,this.options.ignoreJSONStructure),y,r,{...n,...t,interpolationkey:m})};this.resetRegExp();const f=n?.missingInterpolationHandler||this.options.missingInterpolationHandler,u=n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:h=>$e(h)},{regex:this.regexp,safeValue:h=>this.escapeValue?$e(this.escape(h)):$e(h)}].forEach(h=>{for(a=0;i=h.regex.exec(e);){const p=i[1].trim();if(o=d(p),o===void 0)if(typeof f=="function"){const y=f(e,i,n);o=b(y)?y:""}else if(n&&Object.prototype.hasOwnProperty.call(n,p))o="";else if(u){o=i[0];continue}else this.logger.warn(`missed to pass in variable ${p} for interpolating ${e}`),o="";else!b(o)&&!this.useRawValueToEscape&&(o=pt(o));const m=h.safeValue(o);if(e=e.replace(i[0],m),u?(h.regex.lastIndex+=o.length,h.regex.lastIndex-=i[0].length):h.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,t,r={}){let n,i,o;const a=(l,d)=>{const f=this.nestingOptionsSeparator;if(l.indexOf(f)<0)return l;const u=l.split(new RegExp(`${f}[ ]*{`));let g=`{${u[1]}`;l=u[0],g=this.interpolate(g,o);const h=g.match(/'/g),p=g.match(/"/g);((h?.length??0)%2===0&&!p||p.length%2!==0)&&(g=g.replace(/'/g,'"'));try{o=JSON.parse(g),d&&(o={...d,...o})}catch(m){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,m),`${l}${f}${g}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,l};for(;n=this.nestingRegexp.exec(e);){let l=[];o={...r},o=o.replace&&!b(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;const d=/{.*}/.test(n[1])?n[1].lastIndexOf("}")+1:n[1].indexOf(this.formatSeparator);if(d!==-1&&(l=n[1].slice(d).split(this.formatSeparator).map(f=>f.trim()).filter(Boolean),n[1]=n[1].slice(0,d)),i=t(a.call(this,n[1].trim(),o),o),i&&n[0]===e&&!b(i))return i;b(i)||(i=pt(i)),i||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),i=""),l.length&&(i=l.reduce((f,u)=>this.format(f,u,r.lng,{...r,interpolationkey:n[1].trim()}),i.trim())),e=e.replace(n[0],i),this.regexp.lastIndex=0}return e}}const _r=s=>{let e=s.toLowerCase().trim();const t={};if(s.indexOf("(")>-1){const r=s.split("(");e=r[0].toLowerCase().trim();const n=r[1].substring(0,r[1].length-1);e==="currency"&&n.indexOf(":")<0?t.currency||(t.currency=n.trim()):e==="relativetime"&&n.indexOf(":")<0?t.range||(t.range=n.trim()):n.split(";").forEach(o=>{if(o){const[a,...l]=o.split(":"),d=l.join(":").trim().replace(/^'+|'+$/g,""),f=a.trim();t[f]||(t[f]=d),d==="false"&&(t[f]=!1),d==="true"&&(t[f]=!0),isNaN(d)||(t[f]=parseInt(d,10))}})}return{formatName:e,formatOptions:t}},Rt=s=>{const e={};return(t,r,n)=>{let i=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(i={...i,[n.interpolationkey]:void 0});const o=r+JSON.stringify(i);let a=e[o];return a||(a=s(me(r),n),e[o]=a),a(t)}},Or=s=>(e,t,r)=>s(me(t),r)(e);class Tr{constructor(e={}){this.logger=J.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const r=t.cacheInBuiltFormats?Rt:Or;this.formats={number:r((n,i)=>{const o=new Intl.NumberFormat(n,{...i});return a=>o.format(a)}),currency:r((n,i)=>{const o=new Intl.NumberFormat(n,{...i,style:"currency"});return a=>o.format(a)}),datetime:r((n,i)=>{const o=new Intl.DateTimeFormat(n,{...i});return a=>o.format(a)}),relativetime:r((n,i)=>{const o=new Intl.RelativeTimeFormat(n,{...i});return a=>o.format(a,i.range||"day")}),list:r((n,i)=>{const o=new Intl.ListFormat(n,{...i});return a=>o.format(a)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Rt(t)}format(e,t,r,n={}){const i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(a=>a.indexOf(")")>-1)){const a=i.findIndex(l=>l.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,a)].join(this.formatSeparator)}return i.reduce((a,l)=>{const{formatName:d,formatOptions:f}=_r(l);if(this.formats[d]){let u=a;try{const g=n?.formatParams?.[n.interpolationkey]||{},h=g.locale||g.lng||n.locale||n.lng||r;u=this.formats[d](a,h,{...f,...n,...g})}catch(g){this.logger.warn(g)}return u}else this.logger.warn(`there was no format function for ${d}`);return a},e)}}const Fr=(s,e)=>{s.pending[e]!==void 0&&(delete s.pending[e],s.pendingCount--)};class Ir extends Te{constructor(e,t,r,n={}){super(),this.backend=e,this.store=t,this.services=r,this.languageUtils=r.languageUtils,this.options=n,this.logger=J.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(r,n.backend,n)}queueLoad(e,t,r,n){const i={},o={},a={},l={};return e.forEach(d=>{let f=!0;t.forEach(u=>{const g=`${d}|${u}`;!r.reload&&this.store.hasResourceBundle(d,u)?this.state[g]=2:this.state[g]<0||(this.state[g]===1?o[g]===void 0&&(o[g]=!0):(this.state[g]=1,f=!1,o[g]===void 0&&(o[g]=!0),i[g]===void 0&&(i[g]=!0),l[u]===void 0&&(l[u]=!0)))}),f||(a[d]=!0)}),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(l)}}loaded(e,t,r){const n=e.split("|"),i=n[0],o=n[1];t&&this.emit("failedLoading",i,o,t),!t&&r&&this.store.addResourceBundle(i,o,r,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&r&&(this.state[e]=0);const a={};this.queue.forEach(l=>{br(l.loaded,[i],o),Fr(l,e),t&&l.errors.push(t),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(d=>{a[d]||(a[d]={});const f=l.loaded[d];f.length&&f.forEach(u=>{a[d][u]===void 0&&(a[d][u]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(l=>!l.done)}read(e,t,r,n=0,i=this.retryTimeout,o){if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:r,tried:n,wait:i,callback:o});return}this.readingCalls++;const a=(d,f)=>{if(this.readingCalls--,this.waitingReads.length>0){const u=this.waitingReads.shift();this.read(u.lng,u.ns,u.fcName,u.tried,u.wait,u.callback)}if(d&&f&&n<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,r,n+1,i*2,o)},i);return}o(d,f)},l=this.backend[r].bind(this.backend);if(l.length===2){try{const d=l(e,t);d&&typeof d.then=="function"?d.then(f=>a(null,f)).catch(a):a(null,d)}catch(d){a(d)}return}return l(e,t,a)}prepareLoading(e,t,r={},n){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();b(e)&&(e=this.languageUtils.toResolveHierarchy(e)),b(t)&&(t=[t]);const i=this.queueLoad(e,t,r,n);if(!i.toLoad.length)return i.pending.length||n(),null;i.toLoad.forEach(o=>{this.loadOne(o)})}load(e,t,r){this.prepareLoading(e,t,{},r)}reload(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}loadOne(e,t=""){const r=e.split("|"),n=r[0],i=r[1];this.read(n,i,"read",void 0,void 0,(o,a)=>{o&&this.logger.warn(`${t}loading namespace ${i} for language ${n} failed`,o),!o&&a&&this.logger.log(`${t}loaded namespace ${i} for language ${n}`,a),this.loaded(e,o,a)})}saveMissing(e,t,r,n,i,o={},a=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${r}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if(this.backend?.create){const l={...o,isUpdate:i},d=this.backend.create.bind(this.backend);if(d.length<6)try{let f;d.length===5?f=d(e,t,r,n,l):f=d(e,t,r,n),f&&typeof f.then=="function"?f.then(u=>a(null,u)).catch(a):a(null,f)}catch(f){a(f)}else d(e,t,r,n,a,l)}!e||!e[0]||this.store.addResource(e[0],t,r,n)}}}const kt=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:s=>{let e={};if(typeof s[1]=="object"&&(e=s[1]),b(s[1])&&(e.defaultValue=s[1]),b(s[2])&&(e.tDescription=s[2]),typeof s[2]=="object"||typeof s[3]=="object"){const t=s[3]||s[2];Object.keys(t).forEach(r=>{e[r]=t[r]})}return e},interpolation:{escapeValue:!0,format:s=>s,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Et=s=>(b(s.ns)&&(s.ns=[s.ns]),b(s.fallbackLng)&&(s.fallbackLng=[s.fallbackLng]),b(s.fallbackNS)&&(s.fallbackNS=[s.fallbackNS]),s.supportedLngs?.indexOf?.("cimode")<0&&(s.supportedLngs=s.supportedLngs.concat(["cimode"])),typeof s.initImmediate=="boolean"&&(s.initAsync=s.initImmediate),s),Ne=()=>{},Ar=s=>{Object.getOwnPropertyNames(Object.getPrototypeOf(s)).forEach(t=>{typeof s[t]=="function"&&(s[t]=s[t].bind(s))})};class pe extends Te{constructor(e={},t){if(super(),this.options=Et(e),this.services={},this.logger=J,this.modules={external:[]},Ar(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,typeof e=="function"&&(t=e,e={}),e.defaultNS==null&&e.ns&&(b(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const r=kt();this.options={...r,...this.options,...Et(e)},this.options.interpolation={...r.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator);const n=d=>d?typeof d=="function"?new d:d:null;if(!this.options.isClone){this.modules.logger?J.init(n(this.modules.logger),this.options):J.init(null,this.options);let d;this.modules.formatter?d=this.modules.formatter:d=Tr;const f=new wt(this.options);this.store=new bt(this.options.resources,this.options);const u=this.services;u.logger=J,u.resourceStore=this.store,u.languageUtils=f,u.pluralResolver=new jr(f,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),d&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(u.formatter=n(d),u.formatter.init&&u.formatter.init(u,this.options),this.options.interpolation.format=u.formatter.format.bind(u.formatter)),u.interpolator=new Pr(this.options),u.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},u.backendConnector=new Ir(n(this.modules.backend),u.resourceStore,u,this.options),u.backendConnector.on("*",(h,...p)=>{this.emit(h,...p)}),this.modules.languageDetector&&(u.languageDetector=n(this.modules.languageDetector),u.languageDetector.init&&u.languageDetector.init(u,this.options.detection,this.options)),this.modules.i18nFormat&&(u.i18nFormat=n(this.modules.i18nFormat),u.i18nFormat.init&&u.i18nFormat.init(this)),this.translator=new Le(this.services,this.options),this.translator.on("*",(h,...p)=>{this.emit(h,...p)}),this.modules.external.forEach(h=>{h.init&&h.init(this)})}if(this.format=this.options.interpolation.format,t||(t=Ne),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const d=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);d.length>0&&d[0]!=="dev"&&(this.options.lng=d[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(d=>{this[d]=(...f)=>this.store[d](...f)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(d=>{this[d]=(...f)=>(this.store[d](...f),this)});const a=ce(),l=()=>{const d=(f,u)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),a.resolve(u),t(f,u)};if(this.languages&&!this.isInitialized)return d(null,this.t.bind(this));this.changeLanguage(this.options.lng,d)};return this.options.resources||!this.options.initAsync?l():setTimeout(l,0),a}loadResources(e,t=Ne){let r=t;const n=b(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(n?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const i=[],o=a=>{if(!a||a==="cimode")return;this.services.languageUtils.toResolveHierarchy(a).forEach(d=>{d!=="cimode"&&i.indexOf(d)<0&&i.push(d)})};n?o(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>o(l)),this.options.preload?.forEach?.(a=>o(a)),this.services.backendConnector.load(i,this.options.ns,a=>{!a&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(a)})}else r(null)}reloadResources(e,t,r){const n=ce();return typeof e=="function"&&(r=e,e=void 0),typeof t=="function"&&(r=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),r||(r=Ne),this.services.backendConnector.reload(e,t,i=>{n.resolve(),r(i)}),n}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&Wt.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let t=0;t<this.languages.length;t++){const r=this.languages[t];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const r=ce();this.emit("languageChanging",e);const n=a=>{this.language=a,this.languages=this.services.languageUtils.toResolveHierarchy(a),this.resolvedLanguage=void 0,this.setResolvedLanguage(a)},i=(a,l)=>{l?this.isLanguageChangingTo===e&&(n(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,r.resolve((...d)=>this.t(...d)),t&&t(a,(...d)=>this.t(...d))},o=a=>{!e&&!a&&this.services.languageDetector&&(a=[]);const l=b(a)?a:a&&a[0],d=this.store.hasLanguageSomeTranslations(l)?l:this.services.languageUtils.getBestMatchFromCodes(b(a)?[a]:a);d&&(this.language||n(d),this.translator.language||this.translator.changeLanguage(d),this.services.languageDetector?.cacheUserLanguage?.(d)),this.loadResources(d,f=>{i(f,d)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e),r}getFixedT(e,t,r){const n=(i,o,...a)=>{let l;typeof o!="object"?l=this.options.overloadTranslationOptionHandler([i,o].concat(a)):l={...o},l.lng=l.lng||n.lng,l.lngs=l.lngs||n.lngs,l.ns=l.ns||n.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||r||n.keyPrefix);const d=this.options.keySeparator||".";let f;return l.keyPrefix&&Array.isArray(i)?f=i.map(u=>(typeof u=="function"&&(u=We(u,{...this.options,...o})),`${l.keyPrefix}${d}${u}`)):(typeof i=="function"&&(i=We(i,{...this.options,...o})),f=l.keyPrefix?`${l.keyPrefix}${d}${i}`:i),this.t(f,l)};return b(e)?n.lng=e:n.lngs=e,n.ns=t,n.keyPrefix=r,n}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=t.lng||this.resolvedLanguage||this.languages[0],n=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const o=(a,l)=>{const d=this.services.backendConnector.state[`${a}|${l}`];return d===-1||d===0||d===2};if(t.precheck){const a=t.precheck(this,o);if(a!==void 0)return a}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(r,e)&&(!n||o(i,e)))}loadNamespaces(e,t){const r=ce();return this.options.ns?(b(e)&&(e=[e]),e.forEach(n=>{this.options.ns.indexOf(n)<0&&this.options.ns.push(n)}),this.loadResources(n=>{r.resolve(),t&&t(n)}),r):(t&&t(),Promise.resolve())}loadLanguages(e,t){const r=ce();b(e)&&(e=[e]);const n=this.options.preload||[],i=e.filter(o=>n.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return i.length?(this.options.preload=n.concat(i),this.loadResources(o=>{r.resolve(),t&&t(o)}),r):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const n=new Intl.Locale(e);if(n&&n.getTextInfo){const i=n.getTextInfo();if(i&&i.direction)return i.direction}}catch{}const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=this.services?.languageUtils||new wt(kt());return e.toLowerCase().indexOf("-latn")>1?"ltr":t.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){const r=new pe(e,t);return r.createInstance=pe.createInstance,r}cloneInstance(e={},t=Ne){const r=e.forkResourceStore;r&&delete e.forkResourceStore;const n={...this.options,...e,isClone:!0},i=new pe(n);if((e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(a=>{i[a]=this[a]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},r){const a=Object.keys(this.store.data).reduce((l,d)=>(l[d]={...this.store.data[d]},l[d]=Object.keys(l[d]).reduce((f,u)=>(f[u]={...l[d][u]},f),l[d]),l),{});i.store=new bt(a,n),i.services.resourceStore=i.store}return i.translator=new Le(i.services,n),i.translator.on("*",(a,...l)=>{i.emit(a,...l)}),i.init(n,t),i.translator.options=n,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const U=pe.createInstance();U.createInstance;U.dir;U.init;U.loadResources;U.reloadResources;U.use;U.changeLanguage;U.getFixedT;U.t;U.exists;U.setDefaultNamespace;U.hasLoadedNamespace;U.loadNamespaces;U.loadLanguages;const Mr=(s,e,t,r)=>{const n=[t,{code:e,...r||{}}];if(s?.services?.logger?.forward)return s.services.logger.forward(n,"warn","react-i18next::",!0);Q(n[0])&&(n[0]=`react-i18next:: ${n[0]}`),s?.services?.logger?.warn?s.services.logger.warn(...n):console?.warn&&console.warn(...n)},Lt={},qt=(s,e,t,r)=>{Q(t)&&Lt[t]||(Q(t)&&(Lt[t]=new Date),Mr(s,e,t,r))},Xt=(s,e)=>()=>{if(s.isInitialized)e();else{const t=()=>{setTimeout(()=>{s.off("initialized",t)},0),e()};s.on("initialized",t)}},Ke=(s,e,t)=>{s.loadNamespaces(e,Xt(s,t))},jt=(s,e,t,r)=>{if(Q(t)&&(t=[t]),s.options.preload&&s.options.preload.indexOf(e)>-1)return Ke(s,t,r);t.forEach(n=>{s.options.ns.indexOf(n)<0&&s.options.ns.push(n)}),s.loadLanguages(e,Xt(s,r))},Dr=(s,e,t={})=>!e.languages||!e.languages.length?(qt(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(s,{lng:t.lng,precheck:(r,n)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!n(r.isLanguageChangingTo,s))return!1}}),Q=s=>typeof s=="string",$r=s=>typeof s=="object"&&s!==null,zr=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Ur={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},Br=s=>Ur[s],Hr=s=>s.replace(zr,Br);let qe={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:Hr};const Gr=(s={})=>{qe={...qe,...s}},Vr=()=>qe;let Jt;const Wr=s=>{Jt=s},Kr=()=>Jt,qr={type:"3rdParty",init(s){Gr(s.options.react),Wr(s)}},Xr=x.createContext();class Jr{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var ze={exports:{}},Ue={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pt;function Yr(){if(Pt)return Ue;Pt=1;var s=nt();function e(u,g){return u===g&&(u!==0||1/u===1/g)||u!==u&&g!==g}var t=typeof Object.is=="function"?Object.is:e,r=s.useState,n=s.useEffect,i=s.useLayoutEffect,o=s.useDebugValue;function a(u,g){var h=g(),p=r({inst:{value:h,getSnapshot:g}}),m=p[0].inst,y=p[1];return i(function(){m.value=h,m.getSnapshot=g,l(m)&&y({inst:m})},[u,h,g]),n(function(){return l(m)&&y({inst:m}),u(function(){l(m)&&y({inst:m})})},[u]),o(h),h}function l(u){var g=u.getSnapshot;u=u.value;try{var h=g();return!t(u,h)}catch{return!0}}function d(u,g){return g()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:a;return Ue.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:f,Ue}var _t;function Zr(){return _t||(_t=1,ze.exports=Yr()),ze.exports}var Qr=Zr();const en=(s,e)=>Q(e)?e:$r(e)&&Q(e.defaultValue)?e.defaultValue:Array.isArray(s)?s[s.length-1]:s,tn={t:en,ready:!1},rn=()=>()=>{},ae=(s,e={})=>{const{i18n:t}=e,{i18n:r,defaultNS:n}=x.useContext(Xr)||{},i=t||r||Kr();i&&!i.reportNamespaces&&(i.reportNamespaces=new Jr),i||qt(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const o=x.useMemo(()=>({...Vr(),...i?.options?.react,...e}),[i,e]),{useSuspense:a,keyPrefix:l}=o,d=x.useMemo(()=>{const N=n||i?.options?.defaultNS;return Q(N)?[N]:N||["translation"]},[s,n,i]);i?.reportNamespaces?.addUsedNamespaces?.(d);const f=x.useRef(0),u=x.useCallback(N=>{if(!i)return rn;const{bindI18n:k,bindI18nStore:S}=o,E=()=>{f.current+=1,N()};return k&&i.on(k,E),S&&i.store.on(S,E),()=>{k&&k.split(" ").forEach(j=>i.off(j,E)),S&&S.split(" ").forEach(j=>i.store.off(j,E))}},[i,o]),g=x.useRef(),h=x.useCallback(()=>{if(!i)return tn;const N=!!(i.isInitialized||i.initializedStoreOnce)&&d.every(O=>Dr(O,i,o)),k=e.lng||i.language,S=f.current,E=g.current;if(E&&E.ready===N&&E.lng===k&&E.keyPrefix===l&&E.revision===S)return E;const B={t:i.getFixedT(k,o.nsMode==="fallback"?d:d[0],l),ready:N,lng:k,keyPrefix:l,revision:S};return g.current=B,B},[i,d,l,o,e.lng]),[p,m]=x.useState(0),{t:y,ready:C}=Qr.useSyncExternalStore(u,h,h);x.useEffect(()=>{if(i&&!C&&!a){const N=()=>m(k=>k+1);e.lng?jt(i,e.lng,d,N):Ke(i,d,N)}},[i,e.lng,d,C,a,p]);const w=i||{},D=x.useRef(null),L=x.useRef(),v=N=>{const k=Object.getOwnPropertyDescriptors(N);k.__original&&delete k.__original;const S=Object.create(Object.getPrototypeOf(N),k);if(!Object.prototype.hasOwnProperty.call(S,"__original"))try{Object.defineProperty(S,"__original",{value:N,writable:!1,enumerable:!1,configurable:!1})}catch{}return S},_=x.useMemo(()=>{const N=w,k=N?.language;let S=N;N&&(D.current&&D.current.__original===N?L.current!==k?(S=v(N),D.current=S,L.current=k):S=D.current:(S=v(N),D.current=S,L.current=k));const E=[y,S,C];return E.t=y,E.i18n=S,E.ready=C,E},[y,w,C,w.resolvedLanguage,w.language,w.languages]);if(i&&a&&!C)throw new Promise(N=>{const k=()=>N();e.lng?jt(i,e.lng,d,k):Ke(i,d,k)});return _};/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nn=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Yt=(...s)=>s.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sn={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=x.forwardRef(({color:s="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:n="",children:i,iconNode:o,...a},l)=>x.createElement("svg",{ref:l,...sn,width:e,height:e,stroke:s,strokeWidth:r?Number(t)*24/Number(e):t,className:Yt("lucide",n),...a},[...o.map(([d,f])=>x.createElement(d,f)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=(s,e)=>{const t=x.forwardRef(({className:r,...n},i)=>x.createElement(on,{ref:i,iconNode:e,className:Yt(`lucide-${nn(s)}`,r),...n}));return t.displayName=`${s}`,t};/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=q("CameraOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=q("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=q("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=q("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=q("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=q("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=q("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=q("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=q("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=q("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=q("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),gn=1,hn=.5,pn="https://storage.googleapis.com/mediapipe-models/image_segmenter/selfie_multiclass_256x256/float32/1/selfie_multiclass_256x256.tflite",mn="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm";class xn{segmenter=null;isInitialized=!1;initializationPromise=null;confidenceThreshold=hn;async initialize(e=!0){if(this.isInitialized&&this.segmenter)return Promise.resolve();if(this.initializationPromise)return this.initializationPromise;this.initializationPromise=this._performInitialization(e);try{await this.initializationPromise,this.isInitialized=!0}catch(t){throw this.initializationPromise=null,t}return this.initializationPromise}async _performInitialization(e){try{console.log("[MediaPipe] Initializing vision tasks...");const t=await cr.forVisionTasks(mn);console.log("[MediaPipe] Creating ImageSegmenter..."),this.segmenter=await dr.createFromOptions(t,{baseOptions:{modelAssetPath:pn,delegate:e?"GPU":"CPU"},runningMode:"IMAGE",outputCategoryMask:!0,outputConfidenceMasks:!1}),console.log("[MediaPipe] Initialization complete",{delegate:e?"GPU":"CPU",model:"selfie_multiclass_256x256"})}catch(t){const r=t instanceof Error?t.message:"Unknown error";throw console.error("[MediaPipe] Initialization failed:",r),new Error(`Failed to initialize MediaPipe: ${r}`)}}async segmentImage(e,t){if(!this.isInitialized||!this.segmenter)throw new Error("MediaPipe service not initialized. Call initialize() first.");const r=performance.now();try{console.log("⚡ =========================================="),console.log("⚡ [MediaPipe] USING MediaPipe (Fast Mode)"),console.log("⚡ ==========================================");const n=this.segmenter.segment(e),i=this.extractHairMask(n),o=performance.now()-r,a=this._calculateConfidence(i);return console.log("[MediaPipe] Segmentation complete",{processingTime:`${o.toFixed(2)}ms`,confidence:`${(a*100).toFixed(1)}%`,maskSize:i.length}),{mask:i,width:n.categoryMask?.width||e.width,height:n.categoryMask?.height||e.height,confidence:a,processingTime:o,timestamp:Date.now()}}catch(n){const i=n instanceof Error?n.message:"Unknown error";throw console.error("[MediaPipe] Segmentation failed:",i),new Error(`Hair segmentation failed: ${i}`)}}extractHairMask(e){if(!e.categoryMask)throw new Error("Segmentation result missing category mask");const{width:t,height:r}=e.categoryMask,n=e.categoryMask.getAsUint8Array(),i=new Uint8Array(t*r);for(let o=0;o<n.length;o++)i[o]=n[o]===gn?255:0;return i}setConfidenceThreshold(e){if(e<0||e>1)throw new Error("Confidence threshold must be between 0 and 1");this.confidenceThreshold=e,console.log("[MediaPipe] Confidence threshold set to:",e)}getConfidenceThreshold(){return this.confidenceThreshold}_calculateConfidence(e){let t=0,r=e.length;for(let n=0;n<e.length;n++)e[n]===255&&t++;return t/r}isReady(){return this.isInitialized&&this.segmenter!==null}dispose(){this.segmenter&&(this.segmenter.close(),this.segmenter=null),this.isInitialized=!1,this.initializationPromise=null,console.log("[MediaPipe] Resources disposed")}}const ie=new xn,yn={enabled:!0,guidedFilter:{radius:8,epsilon:.01},edgeEnhancement:{enabled:!0,sigma:1,strength:.3},detailRecovery:{enabled:!0,highFreqWeight:.4,confidenceThreshold:.3,strandWidth:2}};class bn{config=yn;setConfig(e){this.config={...this.config,...e},console.log("[Refinement] Configuration updated:",this.config)}getConfig(){return{...this.config}}async refine(e,t,r,n){if(!this.config.enabled)return console.log("[Refinement] Refinement disabled, returning original alpha"),e;const i=performance.now();console.log("[Refinement] Starting refinement pipeline...");let o=new Float32Array(e);o=this.applyGuidedFilter(o,t,r,n),this.config.edgeEnhancement?.enabled&&(o=this.enhanceEdges(o,r,n)),this.config.detailRecovery?.enabled&&(o=this.recoverDetails(o,t,r,n));const a=performance.now()-i;return console.log("[Refinement] Refinement complete",{processingTime:`${a.toFixed(2)}ms`}),o}applyGuidedFilter(e,t,r,n){console.log("[Refinement] Applying guided filter...");const i=this.extractGrayscale(t,r,n),o=this.config.guidedFilter.radius,a=this.config.guidedFilter.epsilon,l=this.boxFilter(i,r,n,o),d=this.boxFilter(e,r,n,o),f=this.multiply(i,i,r,n),u=this.multiply(i,e,r,n),g=this.boxFilter(f,r,n,o),h=this.boxFilter(u,r,n,o),p=this.subtract(g,this.multiply(l,l,r,n),r,n),m=this.subtract(h,this.multiply(l,d,r,n),r,n),y=new Float32Array(r*n),C=new Float32Array(r*n);for(let v=0;v<r*n;v++)y[v]=m[v]/(p[v]+a),C[v]=d[v]-y[v]*l[v];const w=this.boxFilter(y,r,n,o),D=this.boxFilter(C,r,n,o),L=new Float32Array(r*n);for(let v=0;v<r*n;v++)L[v]=Math.max(0,Math.min(1,w[v]*i[v]+D[v]));return L}enhanceEdges(e,t,r){console.log("[Refinement] Enhancing edges...");const n=this.config.edgeEnhancement?.sigma??1,i=this.config.edgeEnhancement?.strength??.3,o=this.laplacianOfGaussian(e,t,r,n),a=new Float32Array(t*r);for(let l=0;l<t*r;l++)a[l]=Math.max(0,Math.min(1,e[l]+i*o[l]));return a}recoverDetails(e,t,r,n){console.log("[Refinement] Recovering fine details...");const i=this.extractGrayscale(t,r,n),o=this.gaussianBlur(i,r,n,2),a=this.subtract(i,o,r,n),l=this.config.detailRecovery?.strandWidth??2,d=this.detectThinStructures(a,r,n,l),f=new Float32Array(r*n),u=this.config.detailRecovery?.highFreqWeight??.4,g=this.config.detailRecovery?.confidenceThreshold??.3;for(let h=0;h<r*n;h++){const p=e[h],m=d[h],y=a[h];p>g&&m>.5?f[h]=Math.min(1,p+u*Math.abs(y)):f[h]=p}return f}morphologicalCleanup(e,t,r){const n=this.erode(e,t,r,1);return this.dilate(n,t,r,1)}extractGrayscale(e,t,r){const n=document.createElement("canvas");n.width=t,n.height=r;const i=n.getContext("2d");if(!i)throw new Error("Failed to get 2D context");i.drawImage(e,0,0,t,r);const a=i.getImageData(0,0,t,r).data,l=new Float32Array(t*r);for(let d=0;d<t*r;d++){const f=d*4;l[d]=(.299*a[f]+.587*a[f+1]+.114*a[f+2])/255}return l}boxFilter(e,t,r,n){const i=new Float32Array(t*r);for(let a=0;a<r;a++)for(let l=0;l<t;l++){let d=0,f=0;const u=Math.max(0,l-n),g=Math.min(t-1,l+n);for(let h=u;h<=g;h++)d+=e[a*t+h],f++;i[a*t+l]=d/f}const o=new Float32Array(t*r);for(let a=0;a<r;a++){const l=Math.max(0,a-n),d=Math.min(r-1,a+n);for(let f=0;f<t;f++){let u=0,g=0;for(let h=l;h<=d;h++)u+=i[h*t+f],g++;o[a*t+f]=u/g}}return o}gaussianBlur(e,t,r,n){const i=Math.ceil(3*n),o=2*i+1,a=new Float32Array(o);let l=0;for(let u=0;u<o;u++){const g=u-i;a[u]=Math.exp(-(g*g)/(2*n*n)),l+=a[u]}for(let u=0;u<o;u++)a[u]/=l;const d=new Float32Array(t*r);for(let u=0;u<r;u++)for(let g=0;g<t;g++){let h=0,p=0;for(let m=0;m<o;m++){const y=g+m-i;y>=0&&y<t&&(h+=e[u*t+y]*a[m],p+=a[m])}d[u*t+g]=p>0?h/p:0}const f=new Float32Array(t*r);for(let u=0;u<r;u++)for(let g=0;g<t;g++){let h=0,p=0;for(let m=0;m<o;m++){const y=u+m-i;y>=0&&y<r&&(h+=d[y*t+g]*a[m],p+=a[m])}f[u*t+g]=p>0?h/p:0}return f}laplacianOfGaussian(e,t,r,n){const i=this.gaussianBlur(e,t,r,n),o=new Float32Array(t*r);for(let a=1;a<r-1;a++)for(let l=1;l<t-1;l++){const d=a*t+l,f=-4*i[d]+i[d-1]+i[d+1]+i[(a-1)*t+l]+i[(a+1)*t+l];o[d]=f}return o}detectThinStructures(e,t,r,n){const i=new Float32Array(t*r);for(let o=0;o<t*r;o++)i[o]=Math.abs(e[o])>.1?1:0;return this.dilate(i,t,r,n)}erode(e,t,r,n){const i=new Float32Array(t*r);for(let o=0;o<r;o++)for(let a=0;a<t;a++){let l=1;for(let d=-n;d<=n;d++)for(let f=-n;f<=n;f++){const u=a+f,g=o+d;u>=0&&u<t&&g>=0&&g<r&&(l=Math.min(l,e[g*t+u]))}i[o*t+a]=l}return i}dilate(e,t,r,n){const i=new Float32Array(t*r);for(let o=0;o<r;o++)for(let a=0;a<t;a++){let l=0;for(let d=-n;d<=n;d++)for(let f=-n;f<=n;f++){const u=a+f,g=o+d;u>=0&&u<t&&g>=0&&g<r&&(l=Math.max(l,e[g*t+u]))}i[o*t+a]=l}return i}multiply(e,t,r,n){const i=new Float32Array(r*n);for(let o=0;o<r*n;o++)i[o]=e[o]*t[o];return i}subtract(e,t,r,n){const i=new Float32Array(r*n);for(let o=0;o<r*n;o++)i[o]=e[o]-t[o];return i}}const vn=new bn,je=!0;st.allowLocalModels=je;st.allowRemoteModels=!je;st.localModelPath="/virtualtryon/models/";const wn=()=>"/virtualtryon/",Be=`${wn()}models/modnet`;class Sn{segmenter=null;isInitialized=!1;initializationPromise=null;async initialize(e=!0){if(this.isInitialized&&this.segmenter)return Promise.resolve();if(this.initializationPromise)return this.initializationPromise;this.initializationPromise=this._performInitialization(e);try{await this.initializationPromise,this.isInitialized=!0}catch(t){throw this.initializationPromise=null,t}return this.initializationPromise}async _performInitialization(e){try{console.log("[MODNet] Initializing Transformers.js pipeline...");const t=e?"webgpu":"wasm";console.log("[MODNet] Loading model...",{modelId:Be,useLocalModels:je,device:t}),this.segmenter=await ur("background-removal",Be,{dtype:"fp32",device:t}),console.log("[MODNet] Initialization complete",{device:t,model:Be,useLocalModels:je})}catch(t){const r=t instanceof Error?t.message:"Unknown error";if(console.error("[MODNet] Initialization failed:",r),e&&r.includes("webgpu"))return console.log("[MODNet] WebGPU failed, falling back to WASM..."),this._performInitialization(!1);throw new Error(`Failed to initialize MODNet: ${r}`)}}async segmentImage(e){if(!this.isInitialized||!this.segmenter)throw new Error("MODNet service not initialized. Call initialize() first.");const t=performance.now();try{console.log("🎨 =========================================="),console.log("🎨 [MODNet] USING MODNet (High Quality Mode)"),console.log("🎨 =========================================="),console.log("[MODNet] Running segmentation...");const r=e instanceof HTMLImageElement?await ut.fromURL(e.src):await this._convertToRawImage(e),n=await this.segmenter(r);console.log("[MODNet] Segmenter output:",{outputType:n?.constructor?.name,isArray:Array.isArray(n),length:n?.length,keys:n?Object.keys(n).join(", "):"null",output0Type:n?.[0]?.constructor?.name,output0Keys:n?.[0]?Object.keys(n[0]).join(", "):"null"});const i=n[0],o=await this._extractAlphaChannel(i,e.width,e.height),a=this._convertUint8ToFloat32(o);console.log("✨ [MODNet] Applying optimized matting refinement pipeline...");const l=performance.now(),d=e instanceof HTMLImageElement?e:await this._convertElementToCanvas(e),f=await vn.refine(a,d,e.width,e.height),u=performance.now()-l;console.log(`✨ [MODNet] Refinement complete in ${u.toFixed(2)}ms`);const g=this._convertFloat32ToUint8(f),h=performance.now()-t,p=this._calculateConfidence(g);return console.log("[MODNet] Segmentation complete",{processingTime:`${h.toFixed(2)}ms`,confidence:`${(p*100).toFixed(1)}%`,maskSize:g.length}),{mask:g,width:e.width,height:e.height,confidence:p,processingTime:h,timestamp:Date.now()}}catch(r){const n=r instanceof Error?r.message:"Unknown error";throw console.error("[MODNet] Segmentation failed:",n),new Error(`Hair segmentation failed: ${n}`)}}async _convertElementToCanvas(e){if(e instanceof HTMLCanvasElement)return e;const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("Failed to get 2D context");const n=e.videoWidth,i=e.videoHeight;return t.width=n,t.height=i,r.drawImage(e,0,0,n,i),t}async _convertToRawImage(e){const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("Failed to get 2D context");const n="videoWidth"in e?e.videoWidth:e.width,i="videoHeight"in e?e.videoHeight:e.height;t.width=n,t.height=i,r.drawImage(e,0,0,n,i);const o=await new Promise(d=>{t.toBlob(f=>d(f),"image/png")}),a=URL.createObjectURL(o),l=await ut.fromURL(a);return URL.revokeObjectURL(a),l}async _extractAlphaAsFloat32(e,t,r){const o=(await e.resize(t,r)).toTensor().to("float32").data;return new Float32Array(o)}_convertUint8ToFloat32(e){const t=new Float32Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r]/255;return t}_convertFloat32ToUint8(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){const n=Math.max(0,Math.min(1,e[r]));t[r]=Math.round(n*255)}return t}async _extractAlphaChannel(e,t,r){console.log("[MODNet] BEFORE resize:",{type:e?.constructor?.name,width:e.width,height:e.height,channels:e.channels,hasData:!!e.data,hasResize:typeof e.resize,keys:Object.keys(e).slice(0,20).join(", ")});const n=await e.resize(t,r);console.log("[MODNet] AFTER resize:",{type:n?.constructor?.name,width:n.width,height:n.height,channels:n.channels,dataType:n.data?.constructor?.name,dataLength:n.data?.length,hasToTensor:typeof n.toTensor,keys:Object.keys(n).slice(0,20).join(", ")});const i=n.data,o=n.channels;if(!i||i.length===0)throw console.error("[MODNet] RawImage.data is empty or undefined!"),new Error("Failed to extract alpha channel: data is empty");console.log("[MODNet] Extracted data:",{length:i.length,channels:o,expectedLength:t*r,firstFewValues:Array.from(i.slice(0,10))});const a=t*r,l=new Uint8Array(a);if(o===1)l.set(i.slice(0,a));else if(o===3||o===4)for(let p=0;p<a;p++)l[p]=i[p*o];else throw new Error(`Unexpected number of channels: ${o}`);let d=255,f=0,u=0,g=0,h=0;for(let p=0;p<l.length;p++){const m=l[p];m<d&&(d=m),m>f&&(f=m),u+=m,m>0&&g++,m===255&&h++}return console.log("[MODNet] Alpha channel extracted:",{outputLength:l.length,firstFewAlphaValues:Array.from(l.slice(0,10)),min:d,max:f,avg:u/l.length,nonZeroCount:g,fullWhiteCount:h,percentageNonZero:(g/l.length*100).toFixed(1)+"%"}),l}_calculateConfidence(e){let t=0;const r=127;for(let n=0;n<e.length;n++)e[n]>r&&t++;return t/e.length}isReady(){return this.isInitialized&&this.segmenter!==null}dispose(){this.segmenter&&(this.segmenter=null),this.isInitialized=!1,this.initializationPromise=null,console.log("[MODNet] Resources disposed")}}const de=new Sn;class Cn{initialized=new Map;serverConfig=null;async initialize(e,t){if(this.initialized.get(e))return Promise.resolve();switch(console.log(`[Orchestrator] Initializing ${e} method...`),e){case"modnet":await ie.initialize(!0),await de.initialize(!0),this.initialized.set("modnet",!0);break;case"server":if(!t)throw new Error("Server configuration required for server-side segmentation");this.serverConfig=t,this.initialized.set("server",!0),console.log("[Orchestrator] Server-side segmentation configured");break;default:throw new Error(`Unknown segmentation method: ${e}`)}console.log(`[Orchestrator] ${e} method initialized successfully`)}async segment(e,t){switch(this.initialized.get(t)||await this.initialize(t),console.log(`[Orchestrator] Segmenting with ${t} method...`),t){case"modnet":return await this._twoStageSegmentation(e);case"server":return await this._segmentOnServer(e);default:throw new Error(`Unknown segmentation method: ${t}`)}}async _twoStageSegmentation(e){console.log("🎯 [Orchestrator] Two-stage segmentation: MediaPipe + MODNet");const t=performance.now();ie.isReady()||(await ie.initialize(!0),this.initialized.set("modnet",!0)),this.initialized.get("modnet")||(await de.initialize(!0),this.initialized.set("modnet",!0)),console.log("🎯 Stage 1: MediaPipe semantic segmentation (hair identification)...");const n=(await ie.segmentImage(e)).mask;console.log("🎯 Stage 2: MODNet alpha matting (edge refinement)...");const o=(await de.segmentImage(e)).mask;console.log("🎯 Stage 3: Combining masks (hair × alpha)...");const a=new Uint8Array(n.length);for(let g=0;g<n.length;g++){const h=n[g]/255,p=o[g]/255;a[g]=Math.round(h*p*255)}const l=performance.now()-t;let d=0;const f=127;for(let g=0;g<a.length;g++)a[g]>f&&d++;const u=d/a.length;return console.log("🎯 [Orchestrator] Two-stage complete:",{processingTime:`${l.toFixed(2)}ms`,confidence:`${(u*100).toFixed(1)}%`,hairOnlyPixels:d}),{mask:a,width:e.width,height:e.height,confidence:u,processingTime:l,timestamp:Date.now()}}async _segmentOnServer(e){if(!this.serverConfig)throw new Error("Server-side segmentation not configured");return console.warn("[Orchestrator] Server-side segmentation is not yet implemented"),{mask:new Uint8Array(e.width*e.height).fill(0),width:e.width,height:e.height,confidence:0,processingTime:0,timestamp:Date.now()}}isReady(e){switch(e){case"modnet":return ie.isReady()&&de.isReady();case"server":return this.initialized.get("server")===!0;default:return!1}}getMethodName(e){switch(e){case"modnet":return"AI Segmentation (Recommended)";case"server":return"Server-side (Coming Soon)";default:return"Unknown"}}getMethodDescription(e){switch(e){case"modnet":return"Two-stage AI: MediaPipe (hair identification) + MODNet (alpha matting). Production quality using Google Pixel 6 approach.";case"server":return"Server-side processing for maximum quality (requires backend).";default:return""}}dispose(){console.log("[Orchestrator] Disposing all segmentation services..."),ie.dispose(),de.dispose(),this.initialized.clear(),this.serverConfig=null,console.log("[Orchestrator] All services disposed")}}const Z=new Cn,Tt=s=>{let e;const t=new Set,r=(d,f)=>{const u=typeof d=="function"?d(e):d;if(!Object.is(u,e)){const g=e;e=f??(typeof u!="object"||u===null)?u:Object.assign({},e,u),t.forEach(h=>h(e,g))}},n=()=>e,a={setState:r,getState:n,getInitialState:()=>l,subscribe:d=>(t.add(d),()=>t.delete(d))},l=e=s(r,n,a);return a},Nn=(s=>s?Tt(s):Tt),Rn=s=>s;function kn(s,e=Rn){const t=ge.useSyncExternalStore(s.subscribe,ge.useCallback(()=>e(s.getState()),[s,e]),ge.useCallback(()=>e(s.getInitialState()),[s,e]));return ge.useDebugValue(t),t}const En=s=>{const e=Nn(s),t=r=>kn(e,r);return Object.assign(t,e),t},Ln=(s=>En);var Qt=Symbol.for("immer-nothing"),Ft=Symbol.for("immer-draftable"),V=Symbol.for("immer-state");function W(s,...e){throw new Error(`[Immer] minified error nr: ${s}. Full error at: https://bit.ly/3cXEKWf`)}var xe=Object.getPrototypeOf;function oe(s){return!!s&&!!s[V]}function ee(s){return s?er(s)||Array.isArray(s)||!!s[Ft]||!!s.constructor?.[Ft]||ve(s)||Ie(s):!1}var jn=Object.prototype.constructor.toString(),It=new WeakMap;function er(s){if(!s||typeof s!="object")return!1;const e=Object.getPrototypeOf(s);if(e===null||e===Object.prototype)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;if(t===Object)return!0;if(typeof t!="function")return!1;let r=It.get(t);return r===void 0&&(r=Function.toString.call(t),It.set(t,r)),r===jn}function Pe(s,e,t=!0){Fe(s)===0?(t?Reflect.ownKeys(s):Object.keys(s)).forEach(n=>{e(n,s[n],s)}):s.forEach((r,n)=>e(n,r,s))}function Fe(s){const e=s[V];return e?e.type_:Array.isArray(s)?1:ve(s)?2:Ie(s)?3:0}function Ye(s,e){return Fe(s)===2?s.has(e):Object.prototype.hasOwnProperty.call(s,e)}function tr(s,e,t){const r=Fe(s);r===2?s.set(e,t):r===3?s.add(t):s[e]=t}function Pn(s,e){return s===e?s!==0||1/s===1/e:s!==s&&e!==e}function ve(s){return s instanceof Map}function Ie(s){return s instanceof Set}function Y(s){return s.copy_||s.base_}function Ze(s,e){if(ve(s))return new Map(s);if(Ie(s))return new Set(s);if(Array.isArray(s))return Array.prototype.slice.call(s);const t=er(s);if(e===!0||e==="class_only"&&!t){const r=Object.getOwnPropertyDescriptors(s);delete r[V];let n=Reflect.ownKeys(r);for(let i=0;i<n.length;i++){const o=n[i],a=r[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(r[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:s[o]})}return Object.create(xe(s),r)}else{const r=xe(s);if(r!==null&&t)return{...s};const n=Object.create(r);return Object.assign(n,s)}}function ot(s,e=!1){return Ae(s)||oe(s)||!ee(s)||(Fe(s)>1&&Object.defineProperties(s,{set:Re,add:Re,clear:Re,delete:Re}),Object.freeze(s),e&&Object.values(s).forEach(t=>ot(t,!0))),s}function _n(){W(2)}var Re={value:_n};function Ae(s){return s===null||typeof s!="object"?!0:Object.isFrozen(s)}var On={};function te(s){const e=On[s];return e||W(0,s),e}var ye;function rr(){return ye}function Tn(s,e){return{drafts_:[],parent_:s,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function At(s,e){e&&(te("Patches"),s.patches_=[],s.inversePatches_=[],s.patchListener_=e)}function Qe(s){et(s),s.drafts_.forEach(Fn),s.drafts_=null}function et(s){s===ye&&(ye=s.parent_)}function Mt(s){return ye=Tn(ye,s)}function Fn(s){const e=s[V];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Dt(s,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return s!==void 0&&s!==t?(t[V].modified_&&(Qe(e),W(4)),ee(s)&&(s=_e(e,s),e.parent_||Oe(e,s)),e.patches_&&te("Patches").generateReplacementPatches_(t[V].base_,s,e.patches_,e.inversePatches_)):s=_e(e,t,[]),Qe(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),s!==Qt?s:void 0}function _e(s,e,t){if(Ae(e))return e;const r=s.immer_.shouldUseStrictIteration(),n=e[V];if(!n)return Pe(e,(i,o)=>$t(s,n,e,i,o,t),r),e;if(n.scope_!==s)return e;if(!n.modified_)return Oe(s,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const i=n.copy_;let o=i,a=!1;n.type_===3&&(o=new Set(i),i.clear(),a=!0),Pe(o,(l,d)=>$t(s,n,i,l,d,t,a),r),Oe(s,i,!1),t&&s.patches_&&te("Patches").generatePatches_(n,t,s.patches_,s.inversePatches_)}return n.copy_}function $t(s,e,t,r,n,i,o){if(n==null||typeof n!="object"&&!o)return;const a=Ae(n);if(!(a&&!o)){if(oe(n)){const l=i&&e&&e.type_!==3&&!Ye(e.assigned_,r)?i.concat(r):void 0,d=_e(s,n,l);if(tr(t,r,d),oe(d))s.canAutoFreeze_=!1;else return}else o&&t.add(n);if(ee(n)&&!a){if(!s.immer_.autoFreeze_&&s.unfinalizedDrafts_<1||e&&e.base_&&e.base_[r]===n&&a)return;_e(s,n),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&(ve(t)?t.has(r):Object.prototype.propertyIsEnumerable.call(t,r))&&Oe(s,n)}}}function Oe(s,e,t=!1){!s.parent_&&s.immer_.autoFreeze_&&s.canAutoFreeze_&&ot(e,t)}function In(s,e){const t=Array.isArray(s),r={type_:t?1:0,scope_:e?e.scope_:rr(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:s,draft_:null,copy_:null,revoke_:null,isManual_:!1};let n=r,i=at;t&&(n=[r],i=be);const{revoke:o,proxy:a}=Proxy.revocable(n,i);return r.draft_=a,r.revoke_=o,a}var at={get(s,e){if(e===V)return s;const t=Y(s);if(!Ye(t,e))return An(s,t,e);const r=t[e];return s.finalized_||!ee(r)?r:r===He(s.base_,e)?(Ge(s),s.copy_[e]=rt(r,s)):r},has(s,e){return e in Y(s)},ownKeys(s){return Reflect.ownKeys(Y(s))},set(s,e,t){const r=nr(Y(s),e);if(r?.set)return r.set.call(s.draft_,t),!0;if(!s.modified_){const n=He(Y(s),e),i=n?.[V];if(i&&i.base_===t)return s.copy_[e]=t,s.assigned_[e]=!1,!0;if(Pn(t,n)&&(t!==void 0||Ye(s.base_,e)))return!0;Ge(s),tt(s)}return s.copy_[e]===t&&(t!==void 0||e in s.copy_)||Number.isNaN(t)&&Number.isNaN(s.copy_[e])||(s.copy_[e]=t,s.assigned_[e]=!0),!0},deleteProperty(s,e){return He(s.base_,e)!==void 0||e in s.base_?(s.assigned_[e]=!1,Ge(s),tt(s)):delete s.assigned_[e],s.copy_&&delete s.copy_[e],!0},getOwnPropertyDescriptor(s,e){const t=Y(s),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:s.type_!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty(){W(11)},getPrototypeOf(s){return xe(s.base_)},setPrototypeOf(){W(12)}},be={};Pe(at,(s,e)=>{be[s]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});be.deleteProperty=function(s,e){return be.set.call(this,s,e,void 0)};be.set=function(s,e,t){return at.set.call(this,s[0],e,t,s[0])};function He(s,e){const t=s[V];return(t?Y(t):s)[e]}function An(s,e,t){const r=nr(e,t);return r?"value"in r?r.value:r.get?.call(s.draft_):void 0}function nr(s,e){if(!(e in s))return;let t=xe(s);for(;t;){const r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=xe(t)}}function tt(s){s.modified_||(s.modified_=!0,s.parent_&&tt(s.parent_))}function Ge(s){s.copy_||(s.copy_=Ze(s.base_,s.scope_.immer_.useStrictShallowCopy_))}var Mn=class{constructor(s){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(e,t,r)=>{if(typeof e=="function"&&typeof t!="function"){const i=t;t=e;const o=this;return function(l=i,...d){return o.produce(l,f=>t.call(this,f,...d))}}typeof t!="function"&&W(6),r!==void 0&&typeof r!="function"&&W(7);let n;if(ee(e)){const i=Mt(this),o=rt(e,void 0);let a=!0;try{n=t(o),a=!1}finally{a?Qe(i):et(i)}return At(i,r),Dt(n,i)}else if(!e||typeof e!="object"){if(n=t(e),n===void 0&&(n=e),n===Qt&&(n=void 0),this.autoFreeze_&&ot(n,!0),r){const i=[],o=[];te("Patches").generateReplacementPatches_(e,n,i,o),r(i,o)}return n}else W(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(o,...a)=>this.produceWithPatches(o,l=>e(l,...a));let r,n;return[this.produce(e,t,(o,a)=>{r=o,n=a}),r,n]},typeof s?.autoFreeze=="boolean"&&this.setAutoFreeze(s.autoFreeze),typeof s?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(s.useStrictShallowCopy),typeof s?.useStrictIteration=="boolean"&&this.setUseStrictIteration(s.useStrictIteration)}createDraft(s){ee(s)||W(8),oe(s)&&(s=Dn(s));const e=Mt(this),t=rt(s,void 0);return t[V].isManual_=!0,et(e),t}finishDraft(s,e){const t=s&&s[V];(!t||!t.isManual_)&&W(9);const{scope_:r}=t;return At(r,e),Dt(void 0,r)}setAutoFreeze(s){this.autoFreeze_=s}setUseStrictShallowCopy(s){this.useStrictShallowCopy_=s}setUseStrictIteration(s){this.useStrictIteration_=s}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(s,e){let t;for(t=e.length-1;t>=0;t--){const n=e[t];if(n.path.length===0&&n.op==="replace"){s=n.value;break}}t>-1&&(e=e.slice(t+1));const r=te("Patches").applyPatches_;return oe(s)?r(s,e):this.produce(s,n=>r(n,e))}};function rt(s,e){const t=ve(s)?te("MapSet").proxyMap_(s,e):Ie(s)?te("MapSet").proxySet_(s,e):In(s,e);return(e?e.scope_:rr()).drafts_.push(t),t}function Dn(s){return oe(s)||W(10,s),sr(s)}function sr(s){if(!ee(s)||Ae(s))return s;const e=s[V];let t,r=!0;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=Ze(s,e.scope_.immer_.useStrictShallowCopy_),r=e.scope_.immer_.shouldUseStrictIteration()}else t=Ze(s,!0);return Pe(t,(n,i)=>{tr(t,n,sr(i))},r),e&&(e.finalized_=!1),t}var $n=new Mn,zn=$n.produce;const Un=s=>(e,t,r)=>(r.setState=(n,i,...o)=>{const a=typeof n=="function"?zn(n):n;return e(a,i,...o)},s(r.setState,t,r)),Bn=Un,Hn={opacity:.7,blendMode:"multi-layer",preserveLuminosity:!0,confidenceThreshold:.5},zt={isActive:!1,tool:"brush",brushSize:20,history:[],historyIndex:-1},Gn={fps:0,segmentationTime:0,renderTime:0,totalTime:0},Vn=()=>{const s=localStorage.getItem("language");return s==="zh-CN"||s==="en"?s:"zh-CN"},$=Ln()(Bn(s=>({view:"home",inputMode:"model",language:Vn(),currentImage:null,modelImages:[],userImages:[],segmentationMethod:"modnet",segmentationStatus:"idle",currentMask:null,selectedColor:null,colorSettings:Hn,maskEditor:zt,metrics:Gn,actualFPS:0,error:null,setView:e=>s(t=>{t.view=e}),setInputMode:e=>s(t=>{t.inputMode=e}),setLanguage:e=>s(t=>{t.language=e,localStorage.setItem("language",e)}),setCurrentImage:e=>s(t=>{t.currentImage=e,t.currentMask=null,t.maskEditor=zt}),addUserImage:e=>s(t=>{t.userImages=[...t.userImages,e]}),setSegmentationMethod:e=>s(t=>{t.segmentationMethod=e}),setSegmentationStatus:e=>s(t=>{t.segmentationStatus=e}),setCurrentMask:e=>s(t=>{t.currentMask=e}),setSelectedColor:e=>s(t=>{t.selectedColor=e}),updateColorSettings:e=>s(t=>{t.colorSettings={...t.colorSettings,...e}}),updateMaskEditor:e=>s(t=>{t.maskEditor={...t.maskEditor,...e}}),updateMetrics:e=>s(t=>{t.metrics={...t.metrics,...e}}),setActualFPS:e=>s(t=>{t.actualFPS=e}),setError:e=>s(t=>{t.error=e}),clearError:()=>s(e=>{e.error=null})}))),Wn=()=>$(s=>s.language),ir=()=>$(s=>s.segmentationMethod);function or(){const[s,e]=x.useState(!1),[t,r]=x.useState(null),[n,i]=x.useState(!1),o=x.useRef(!1),a=ir(),l=$(g=>g.setSegmentationStatus),d=$(g=>g.setError);x.useEffect(()=>{(async()=>{if(!o.current){if(Z.isReady(a)){console.log(`[useSegmentation] ${a} already initialized`),e(!0),l("ready");return}o.current=!0;try{console.log(`[useSegmentation] Initializing ${a}...`),l("loading"),e(!1),await Z.initialize(a),e(!0),r(null),l("ready"),console.log(`[useSegmentation] ${a} ready`)}catch(h){const p=h instanceof Error?h.message:`Failed to initialize ${a}`;console.error("[useSegmentation] Initialization error:",p),r(p),e(!1),l("error"),d({code:"SEGMENTATION_INIT_FAILED",message:`Failed to load ${a} segmentation`,details:p,timestamp:Date.now()})}finally{o.current=!1}}})()},[a,l,d]);const f=x.useCallback(async g=>{if(!s)return console.warn(`[useSegmentation] ${a} not ready, cannot segment`),null;try{i(!0),l("segmenting");const h=await Z.segment(g,a);return l("ready"),h}catch(h){const p=h instanceof Error?h.message:"Segmentation failed";return console.error("[useSegmentation] Segmentation error:",p),l("error"),d({code:"SEGMENTATION_FAILED",message:"Unable to detect hair in the image",details:p,timestamp:Date.now()}),null}finally{i(!1)}},[s,a,l,d]),u=x.useCallback(async()=>{console.log(`[useSegmentation] Re-initializing ${a}...`),Z.dispose(),e(!1),r(null),i(!1),o.current=!1;try{l("loading"),await Z.initialize(a),e(!0),r(null),l("ready"),console.log("[useSegmentation] Re-initialization successful")}catch(g){const h=g instanceof Error?g.message:"Re-initialization failed";console.error("[useSegmentation] Re-initialization error:",h),r(h),e(!1),l("error"),d({code:"SEGMENTATION_REINIT_FAILED",message:`Failed to restart ${a} segmentation`,details:h,timestamp:Date.now()})}},[a,l,d]);return{isReady:s,error:t,isSegmenting:n,segment:f,reinitialize:u,currentMethod:a}}const Ut=["image/jpeg","image/png","image/webp"],Kn=10*1024*1024,qn=["jpg","jpeg","png","webp"];function Xn({onImageProcessed:s,className:e=""}){const{t,ready:r}=ae(),[n,i]=x.useState(!1),[o,a]=x.useState(!1),[l,d]=x.useState(null),[f,u]=x.useState(null),g=x.useRef(null),{isReady:h,error:p,segment:m,currentMethod:y}=or(),{setCurrentImage:C,setCurrentMask:w,addUserImage:D}=$(),L=$(R=>R.currentImage);if(x.useEffect(()=>{L&&L.url&&!f&&(console.log("[ImageUploader] Setting preview URL from store:",L.url),u(L.url))},[L,f]),!r)return c.jsx("div",{className:e,children:"Loading..."});const v=R=>{if(!Ut.includes(R.type)){const P=R.name.split(".").pop()?.toLowerCase();if(!P||!qn.includes(P))return{valid:!1,error:t("upload.invalidFileType")}}if(R.size>Kn){const P=(R.size/1048576).toFixed(2);return{valid:!1,error:t("upload.fileTooLarge",{size:P})}}return{valid:!0}},_=x.useCallback(async R=>{const P=v(R);if(!P.valid){d(P.error||"Invalid file");return}d(null),a(!0);try{const A=new FileReader;A.onload=async H=>{const z=H.target?.result;u(z);const F=new Image;F.onload=async()=>{if(console.log("[ImageUploader] Image loaded:",{width:F.width,height:F.height,size:`${(R.size/1024).toFixed(2)}KB`}),C({element:F,url:z,width:F.width,height:F.height,source:"upload"}),D({id:`upload-${Date.now()}`,url:z,element:F,uploadedAt:Date.now()}),h){console.log(`[ImageUploader] Starting hair segmentation using ${y}...`);const T=await m(F);T?(console.log("[ImageUploader] Segmentation complete:",{confidence:`${(T.confidence*100).toFixed(1)}%`,processingTime:`${T.processingTime.toFixed(2)}ms`}),w({data:T.mask,width:T.width,height:T.height,confidence:T.confidence,source:"ai"}),s&&s(F,T.mask)):console.warn("[ImageUploader] Segmentation returned null")}else console.warn(`[ImageUploader] ${y} not ready, skipping segmentation`);a(!1)},F.onerror=()=>{d(t("upload.failedToLoad")),a(!1)},F.src=z},A.onerror=()=>{d(t("upload.failedToRead")),a(!1)},A.readAsDataURL(R)}catch(A){const H=A instanceof Error?A.message:"Unknown error";d(`Error processing file: ${H}`),a(!1)}},[h,m,C,w,D,s]),N=x.useCallback(R=>{const P=R.target.files?.[0];P&&_(P)},[_]),k=x.useCallback(R=>{R.preventDefault(),R.stopPropagation(),i(!0)},[]),S=x.useCallback(R=>{R.preventDefault(),R.stopPropagation(),i(!1)},[]),E=x.useCallback(R=>{R.preventDefault(),R.stopPropagation(),i(!1);const P=R.dataTransfer.files[0];P&&_(P)},[_]),j=x.useCallback(()=>{g.current?.click()},[]),B=l||p,O=o||!h&&!L,M=f||L?.url||null;return c.jsxs("div",{className:`w-full ${e}`,children:[c.jsxs("div",{onClick:j,onDragOver:k,onDragLeave:S,onDrop:E,className:`
          relative flex flex-col items-center justify-center
          min-h-64 p-8 rounded-lg border-2 border-dashed
          transition-all duration-200 cursor-pointer
          ${n?"border-primary bg-primary/5 scale-[1.02]":"border-muted-foreground/25 hover:border-primary/50 hover:bg-muted/50"}
          ${B?"border-destructive/50 bg-destructive/5":""}
          ${o?"cursor-wait":"cursor-pointer"}
        `,children:[c.jsx("input",{ref:g,type:"file",accept:Ut.join(","),onChange:N,className:"hidden",disabled:o}),c.jsx("div",{className:"mb-4",children:M?c.jsx(Je,{className:"w-12 h-12 text-primary"}):c.jsx(Zt,{className:`w-12 h-12 ${n?"text-primary animate-bounce":"text-muted-foreground"}`})}),c.jsx("div",{className:"text-center",children:o?c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"text-lg font-medium mb-2",children:t("upload.processing")}),c.jsx("p",{className:"text-sm text-muted-foreground",children:t("upload.detecting")})]}):!h&&!L?c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"text-lg font-medium mb-2",children:t("upload.loadingModel")}),c.jsx("p",{className:"text-sm text-muted-foreground",children:t("upload.pleaseWait")})]}):M?c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"text-lg font-medium mb-2",children:t("upload.uploaded")}),c.jsx("p",{className:"text-sm text-muted-foreground",children:t("upload.uploadDifferent")})]}):c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"text-lg font-medium mb-2",children:t(n?"upload.dropHere":"upload.uploadYourPhoto")}),c.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t("upload.dragAndDrop")}),c.jsx("p",{className:"text-xs text-muted-foreground",children:t("upload.supported")})]})}),O&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background/80 rounded-lg",children:c.jsx("div",{className:"w-8 h-8 border-4 border-primary/30 border-t-primary rounded-full animate-spin"})}),M&&!o&&c.jsx("div",{className:"mt-4 max-w-xs",children:c.jsx("img",{src:M,alt:"Preview",className:"rounded-lg shadow-md max-h-32 object-cover"})})]}),B&&c.jsxs("div",{className:"mt-4 p-4 rounded-lg bg-destructive/10 border border-destructive/30 flex items-start gap-3",children:[c.jsx(it,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm font-medium text-destructive",children:t("upload.error")}),c.jsx("p",{className:"text-sm text-destructive/80 mt-1",children:B})]})]}),c.jsxs("div",{className:"mt-4 text-xs text-muted-foreground space-y-1",children:[c.jsx("p",{className:"font-medium",children:t("upload.requirements")}),c.jsxs("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[c.jsx("li",{children:t("upload.clearPhoto")}),c.jsx("li",{children:t("upload.hairVisible")}),c.jsx("li",{children:t("upload.frontFacing")}),c.jsx("li",{children:t("upload.plainBackground")})]})]})]})}const Jn={video:{width:{ideal:1280},height:{ideal:720},facingMode:"user",frameRate:{ideal:30,max:60}},audio:!1},ue=640,fe=480,Yn=30,Zn=10;function Qn({applyColor:s=!0,onCameraStart:e,onCameraStop:t,className:r=""}){const[n,i]=x.useState(!1),[o,a]=x.useState(null),[l,d]=x.useState(0),[f,u]=x.useState(!1),g=x.useRef(null),h=x.useRef(null),p=x.useRef(null),m=x.useRef(null),y=x.useRef([]),C=x.useRef(0),{isReady:w,segment:D,currentMethod:L}=or(),{selectedColor:v,setActualFPS:_}=$(),N=x.useCallback(async()=>{try{console.log("[CameraCapture] Requesting camera access..."),a(null),u(!1);const j=await navigator.mediaDevices.getUserMedia(Jn);p.current=j,console.log("[CameraCapture] Camera access granted",{tracks:j.getVideoTracks().length,settings:j.getVideoTracks()[0]?.getSettings()}),g.current&&(g.current.srcObject=j,await g.current.play(),i(!0),a(null),e?.(),console.log("[CameraCapture] Camera started"))}catch(j){const B=j instanceof Error?j.message:"Unknown error";console.error("[CameraCapture] Camera access failed:",B),j instanceof DOMException&&j.name==="NotAllowedError"?(u(!0),a("Camera permission denied. Please allow camera access in your browser settings.")):j instanceof DOMException&&j.name==="NotFoundError"?a("No camera found. Please connect a camera and try again."):a(`Failed to access camera: ${B}`),i(!1)}},[e]),k=x.useCallback(()=>{console.log("[CameraCapture] Stopping camera..."),p.current&&(p.current.getTracks().forEach(j=>{j.stop(),console.log("[CameraCapture] Track stopped:",j.kind)}),p.current=null),g.current&&(g.current.srcObject=null),m.current&&(cancelAnimationFrame(m.current),m.current=null),i(!1),d(0),_(0),y.current=[],t?.(),console.log("[CameraCapture] Camera stopped")},[t,_]),S=x.useCallback(async()=>{if(!n||!g.current||!h.current||!w)return;const j=g.current,O=h.current.getContext("2d");if(!O||j.readyState!==j.HAVE_ENOUGH_DATA){m.current=requestAnimationFrame(S);return}const M=performance.now();try{const R=performance.now();if(y.current.push(R),y.current.length>Yn&&y.current.shift(),y.current.length>=2){const z=R-y.current[0],F=Math.round(y.current.length/z*1e3);d(F),_(F)}const P=R-C.current;if(l>0&&l<Zn&&P<100){m.current=requestAnimationFrame(S);return}C.current=R,O.drawImage(j,0,0,ue,fe);const A=await D(j);if(A&&s&&v){const z=O.getImageData(0,0,ue,fe),F=z.data,T=A.mask,G=v.rgb.r,X=v.rgb.g,we=v.rgb.b,re=v.opacity||.7;for(let Se=0;Se<T.length;Se++)if(T[Se]===255){const ne=Se*4,lt=F[ne],ct=F[ne+1],dt=F[ne+2];F[ne]=lt*(1-re)+lt*G/255*re,F[ne+1]=ct*(1-re)+ct*X/255*re,F[ne+2]=dt*(1-re)+dt*we/255*re}O.putImageData(z,0,0)}else if(A&&!v){const z=O.getImageData(0,0,ue,fe),F=z.data,T=A.mask;for(let G=0;G<T.length;G++)if(T[G]===255){const X=G*4;F[X+1]=Math.min(255,F[X+1]+50)}O.putImageData(z,0,0)}const H=performance.now()-M;console.log(`[CameraCapture] Frame processed in ${H.toFixed(2)}ms`)}catch(R){console.error("[CameraCapture] Frame processing error:",R)}m.current=requestAnimationFrame(S)},[n,w,D,v,s,l,_]);x.useEffect(()=>(n&&w&&!m.current&&(console.log("[CameraCapture] Starting frame processing loop..."),m.current=requestAnimationFrame(S)),()=>{m.current&&(cancelAnimationFrame(m.current),m.current=null)}),[n,w,S]),x.useEffect(()=>()=>{k()},[k]);const E=x.useCallback(()=>{n?k():N()},[n,N,k]);return c.jsxs("div",{className:`w-full ${r}`,children:[c.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-muted",children:[c.jsx("video",{ref:g,className:"hidden",playsInline:!0,muted:!0,autoPlay:!0}),c.jsx("canvas",{ref:h,width:ue,height:fe,className:`w-full h-auto ${n?"block":"hidden"}`}),!n&&c.jsx("div",{className:"aspect-video flex items-center justify-center bg-muted",children:c.jsxs("div",{className:"text-center",children:[c.jsx(Ot,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),c.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Camera Off"}),c.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:'Click "Start Camera" to begin'})]})}),n&&c.jsxs("div",{className:"absolute top-4 right-4 px-3 py-1.5 rounded-md bg-black/60 backdrop-blur-sm text-white text-sm font-mono",children:[l," FPS"]}),n&&c.jsxs("div",{className:"absolute top-4 left-4 flex items-center gap-2 px-3 py-1.5 rounded-md bg-black/60 backdrop-blur-sm text-white text-sm",children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),c.jsx("span",{children:"Live"})]}),!w&&n&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:c.jsxs("div",{className:"text-center text-white",children:[c.jsx("div",{className:"w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-3"}),c.jsxs("p",{className:"text-sm",children:["Loading ",L," model..."]})]})})]}),c.jsx("div",{className:"mt-4 flex items-center justify-center gap-4",children:c.jsx("button",{onClick:E,disabled:!w,className:`
            flex items-center gap-2 px-6 py-3 rounded-lg font-medium
            transition-all duration-200
            ${n?"bg-destructive hover:bg-destructive/90 text-destructive-foreground":"bg-primary hover:bg-primary/90 text-primary-foreground"}
            disabled:opacity-50 disabled:cursor-not-allowed
          `,children:n?c.jsxs(c.Fragment,{children:[c.jsx(Ot,{className:"w-5 h-5"}),c.jsx("span",{children:"Stop Camera"})]}):c.jsxs(c.Fragment,{children:[c.jsx(Xe,{className:"w-5 h-5"}),c.jsx("span",{children:"Start Camera"})]})})}),o&&c.jsxs("div",{className:"mt-4 p-4 rounded-lg bg-destructive/10 border border-destructive/30 flex items-start gap-3",children:[c.jsx(it,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm font-medium text-destructive",children:"Camera Error"}),c.jsx("p",{className:"text-sm text-destructive/80 mt-1",children:o}),f&&c.jsx("p",{className:"text-xs text-destructive/70 mt-2",children:"On mobile: Check Settings → Safari → Camera. On desktop: Click the camera icon in your browser's address bar."})]})]}),n&&l>0&&c.jsx("div",{className:"mt-4 text-xs text-muted-foreground text-center",children:c.jsxs("p",{children:["Performance: ",l>=20?"✅ Excellent":l>=15?"⚠️ Good":"❌ Poor"," • ","Processing at ",ue,"x",fe]})}),!n&&!o&&c.jsxs("div",{className:"mt-4 text-xs text-muted-foreground space-y-1",children:[c.jsx("p",{className:"font-medium",children:"Tips for best results:"}),c.jsxs("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[c.jsx("li",{children:"Use good lighting (face the light source)"}),c.jsx("li",{children:"Keep your face centered in frame"}),c.jsx("li",{children:"Avoid rapid movements for better processing"}),c.jsx("li",{children:"Try different angles to see how colors look"})]})]})]})}const es=`
  attribute vec2 a_position;
  attribute vec2 a_texCoord;

  varying vec2 v_texCoord;

  void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    v_texCoord = a_texCoord;
  }
`,ts=`
  precision mediump float;

  // Textures
  uniform sampler2D u_image;
  uniform sampler2D u_hairMask;

  // Color parameters
  uniform vec3 u_targetColor;
  uniform float u_opacity;
  uniform bool u_multiLayer;
  uniform float u_edgeFeathering;

  // Texture coordinates
  varying vec2 v_texCoord;

  // RGB to HSL conversion
  vec3 rgb2hsl(vec3 rgb) {
    float maxC = max(max(rgb.r, rgb.g), rgb.b);
    float minC = min(min(rgb.r, rgb.g), rgb.b);
    float delta = maxC - minC;

    float l = (maxC + minC) / 2.0;

    if (delta == 0.0) {
      return vec3(0.0, 0.0, l);
    }

    float s = l < 0.5 ? delta / (maxC + minC) : delta / (2.0 - maxC - minC);

    float h;
    if (maxC == rgb.r) {
      h = (rgb.g - rgb.b) / delta + (rgb.g < rgb.b ? 6.0 : 0.0);
    } else if (maxC == rgb.g) {
      h = (rgb.b - rgb.r) / delta + 2.0;
    } else {
      h = (rgb.r - rgb.g) / delta + 4.0;
    }
    h /= 6.0;

    return vec3(h, s, l);
  }

  // Helper function for hue to RGB conversion
  float hue2rgb(float p, float q, float t) {
    if (t < 0.0) t += 1.0;
    if (t > 1.0) t -= 1.0;
    if (t < 1.0 / 6.0) return p + (q - p) * 6.0 * t;
    if (t < 1.0 / 2.0) return q;
    if (t < 2.0 / 3.0) return p + (q - p) * (2.0 / 3.0 - t) * 6.0;
    return p;
  }

  // HSL to RGB conversion
  vec3 hsl2rgb(vec3 hsl) {
    float h = hsl.x;
    float s = hsl.y;
    float l = hsl.z;

    if (s == 0.0) {
      return vec3(l);
    }

    float q = l < 0.5 ? l * (1.0 + s) : l + s - l * s;
    float p = 2.0 * l - q;

    return vec3(
      hue2rgb(p, q, h + 1.0 / 3.0),
      hue2rgb(p, q, h),
      hue2rgb(p, q, h - 1.0 / 3.0)
    );
  }

  // Gaussian blur approximation for edge feathering
  float gaussianBlur(sampler2D tex, vec2 coord, float radius) {
    float sigma = radius / 2.0;
    float total = 0.0;
    float weightSum = 0.0;

    // 3x3 kernel approximation
    for (float x = -1.0; x <= 1.0; x += 1.0) {
      for (float y = -1.0; y <= 1.0; y += 1.0) {
        vec2 offset = vec2(x, y) * radius;
        float weight = exp(-(x * x + y * y) / (2.0 * sigma * sigma));
        total += texture2D(tex, coord + offset).r * weight;
        weightSum += weight;
      }
    }

    return total / weightSum;
  }

  // Multi-layer hair color blending
  vec3 multiLayerBlend(vec3 originalRGB, vec3 targetRGB, float luminosity, float maskValue) {
    // Separate into zones based on luminosity
    float highlightZone = smoothstep(0.6, 0.8, luminosity);
    float midtoneZone = 1.0 - abs(luminosity - 0.5) * 2.0;
    float shadowZone = smoothstep(0.4, 0.2, luminosity);

    // Convert target color to HSL
    vec3 targetHSL = rgb2hsl(targetRGB);

    // Base color: Use target hue/saturation, preserve original luminosity
    vec3 baseHSL = vec3(targetHSL.x, targetHSL.y, luminosity);
    vec3 baseColor = hsl2rgb(baseHSL);

    // Highlights: Blend less to preserve shine
    vec3 highlightColor = mix(baseColor, originalRGB, highlightZone * 0.4);

    // Shadows: Darken slightly to preserve depth
    vec3 shadowColor = baseColor * (1.0 - shadowZone * 0.2);

    // Midtones: Full color application
    vec3 midtoneColor = baseColor;

    // Composite layers
    vec3 result = highlightColor * highlightZone
                + midtoneColor * midtoneZone
                + shadowColor * shadowZone;

    // Normalize if zones don't sum to 1
    float totalZone = highlightZone + midtoneZone + shadowZone;
    if (totalZone > 0.0) {
      result /= totalZone;
    }

    return result;
  }

  void main() {
    // Sample original pixel and mask value
    vec4 originalColor = texture2D(u_image, v_texCoord);
    float maskValue = texture2D(u_hairMask, v_texCoord).r;

    // Apply edge feathering to mask
    if (u_edgeFeathering > 0.0) {
      maskValue = gaussianBlur(u_hairMask, v_texCoord, u_edgeFeathering / 1000.0);
    }

    // If not hair, return original color
    if (maskValue < 0.1) {
      gl_FragColor = originalColor;
      return;
    }

    vec3 blendedColor;

    if (u_multiLayer) {
      // Advanced multi-layer blending
      vec3 originalHSL = rgb2hsl(originalColor.rgb);
      float luminosity = originalHSL.z;

      blendedColor = multiLayerBlend(
        originalColor.rgb,
        u_targetColor,
        luminosity,
        maskValue
      );
    } else {
      // Simple HSL blending (preserves luminosity only)
      vec3 originalHSL = rgb2hsl(originalColor.rgb);
      vec3 targetHSL = rgb2hsl(u_targetColor);

      vec3 blendedHSL = vec3(
        targetHSL.x,
        mix(originalHSL.y, targetHSL.y, u_opacity),
        originalHSL.z  // Preserve original luminosity
      );

      blendedColor = hsl2rgb(blendedHSL);
    }

    // Apply mask with opacity
    vec3 finalColor = mix(
      originalColor.rgb,
      blendedColor,
      maskValue * u_opacity
    );

    gl_FragColor = vec4(finalColor, originalColor.a);
  }
`;class rs{gl=null;program=null;textures=new Map;initialized=!1;locations=null;constructor(e){if(this.gl=e.getContext("webgl2",{preserveDrawingBuffer:!0})||e.getContext("webgl",{preserveDrawingBuffer:!0}),!this.gl)throw new Error("WebGL not supported in this browser");console.log("[WebGLRenderer] Initializing...",{version:this.gl instanceof WebGL2RenderingContext?"WebGL2":"WebGL1",vendor:this.gl.getParameter(this.gl.VENDOR),renderer:this.gl.getParameter(this.gl.RENDERER)});try{this.initializeProgram(),this.setupVertexBuffer(),this.initialized=!0,console.log("[WebGLRenderer] Initialization complete")}catch(t){throw console.error("[WebGLRenderer] Initialization failed:",t),t}}initializeProgram(){if(!this.gl)throw new Error("WebGL context not available");const e=this.compileShader(this.gl.VERTEX_SHADER,es),t=this.compileShader(this.gl.FRAGMENT_SHADER,ts);this.program=this.createProgram(e,t);const r=this.gl.getAttribLocation(this.program,"a_position"),n=this.gl.getAttribLocation(this.program,"a_texCoord"),i=this.gl.getUniformLocation(this.program,"u_image"),o=this.gl.getUniformLocation(this.program,"u_hairMask"),a=this.gl.getUniformLocation(this.program,"u_targetColor"),l=this.gl.getUniformLocation(this.program,"u_opacity"),d=this.gl.getUniformLocation(this.program,"u_multiLayer"),f=this.gl.getUniformLocation(this.program,"u_edgeFeathering");this.locations={attributes:{position:r,texCoord:n},uniforms:{image:i,hairMask:o,targetColor:a,opacity:l,multiLayer:d,edgeFeathering:f}},this.gl.useProgram(this.program)}compileShader(e,t){if(!this.gl)throw new Error("WebGL context not available");const r=this.gl.createShader(e);if(!r)throw new Error("Failed to create shader");if(this.gl.shaderSource(r,t),this.gl.compileShader(r),!this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)){const n=this.gl.getShaderInfoLog(r);throw this.gl.deleteShader(r),new Error(`Shader compilation failed: ${n}`)}return r}createProgram(e,t){if(!this.gl)throw new Error("WebGL context not available");const r=this.gl.createProgram();if(!r)throw new Error("Failed to create program");if(this.gl.attachShader(r,e),this.gl.attachShader(r,t),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS)){const n=this.gl.getProgramInfoLog(r);throw this.gl.deleteProgram(r),new Error(`Program linking failed: ${n}`)}return r}setupVertexBuffer(){if(!this.gl||!this.locations)throw new Error("WebGL not initialized");const e=new Float32Array([-1,-1,1,-1,-1,1,1,1]),t=new Float32Array([0,1,1,1,0,0,1,0]),r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(this.locations.attributes.position),this.gl.vertexAttribPointer(this.locations.attributes.position,2,this.gl.FLOAT,!1,0,0);const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(this.locations.attributes.texCoord),this.gl.vertexAttribPointer(this.locations.attributes.texCoord,2,this.gl.FLOAT,!1,0,0)}uploadTexture(e,t){if(!this.gl)throw new Error("WebGL context not available");let r=this.textures.get(e);if(!r){if(r=this.gl.createTexture(),!r)throw new Error("Failed to create texture");this.textures.set(e,r)}return this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),r}uploadMaskTexture(e,t,r,n){if(!this.gl)throw new Error("WebGL context not available");let i=this.textures.get(e);if(!i){if(i=this.gl.createTexture(),!i)throw new Error("Failed to create texture");this.textures.set(e,i)}return this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,r,n,0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,t),i}render(e,t,r,n,i){if(!this.gl||!this.initialized||!this.locations)throw new Error("WebGL renderer not initialized");const o=performance.now();try{this.uploadTexture("source",e),this.uploadMaskTexture("mask",t,r,n),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures.get("source")),this.gl.uniform1i(this.locations.uniforms.image,0),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures.get("mask")),this.gl.uniform1i(this.locations.uniforms.hairMask,1);const a=i.targetColor.r/255,l=i.targetColor.g/255,d=i.targetColor.b/255;this.gl.uniform3f(this.locations.uniforms.targetColor,a,l,d),this.gl.uniform1f(this.locations.uniforms.opacity,i.opacity),this.gl.uniform1i(this.locations.uniforms.multiLayer,i.multiLayer?1:0),this.gl.uniform1f(this.locations.uniforms.edgeFeathering,i.edgeFeathering||2),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);const f=performance.now()-o;console.log(`[WebGLRenderer] Rendered in ${f.toFixed(2)}ms`)}catch(a){throw console.error("[WebGLRenderer] Render error:",a),a}}dispose(){this.gl&&(console.log("[WebGLRenderer] Disposing resources..."),this.textures.forEach(e=>{this.gl?.deleteTexture(e)}),this.textures.clear(),this.program&&(this.gl.deleteProgram(this.program),this.program=null),this.initialized=!1,this.locations=null,console.log("[WebGLRenderer] Resources disposed"))}}function ns({sourceImage:s,hairMask:e,maskWidth:t,maskHeight:r,className:n="",onRenderComplete:i}){const[o,a]=x.useState(null),[l,d]=x.useState(!1),[f,u]=x.useState(!0),g=x.useRef(null),h=x.useRef(null),p=x.useRef(0),m=$(C=>C.selectedColor),y=$(C=>C.colorSettings);return x.useEffect(()=>{if(g.current){try{console.log("[PreviewCanvas] Initializing WebGL renderer..."),h.current=new rs(g.current),u(!0),a(null)}catch(C){const w=C instanceof Error?C.message:"Unknown error";console.error("[PreviewCanvas] WebGL initialization failed:",w),u(!1),a(`WebGL not available: ${w}`)}return()=>{h.current&&(h.current.dispose(),h.current=null)}}},[]),x.useEffect(()=>{if(!s||!e||!m||!g.current)return;const C=t||s.width,w=r||s.height;(g.current.width!==s.width||g.current.height!==s.height)&&(g.current.width=s.width,g.current.height=s.height),(async()=>{d(!0);const L=performance.now();try{if(h.current&&f){const _={targetColor:m.rgb,opacity:y.opacity,multiLayer:y.blendMode==="multi-layer",edgeFeathering:2};h.current.render(s,e,C,w,_)}else{const _=g.current;if(!_)return;const N=_.getContext("2d");if(!N)return;N.drawImage(s,0,0);const k=N.getImageData(0,0,_.width,_.height),S=k.data,E=m.rgb.r,j=m.rgb.g,B=m.rgb.b,O=y.opacity;for(let M=0;M<e.length;M++)if(e[M]===255){const R=M*4,P=S[R],A=S[R+1],H=S[R+2];S[R]=P*(1-O)+P*E/255*O,S[R+1]=A*(1-O)+A*j/255*O,S[R+2]=H*(1-O)+H*B/255*O}N.putImageData(k,0,0)}const v=performance.now()-L;p.current=v,console.log("[PreviewCanvas] Render complete",{mode:f?"WebGL":"Canvas2D",time:`${v.toFixed(2)}ms`,color:m.name}),a(null),i?.()}catch(v){const _=v instanceof Error?v.message:"Unknown error";console.error("[PreviewCanvas] Render error:",_),a(`Rendering failed: ${_}`)}finally{d(!1)}})()},[s,e,t,r,m,y,f,i]),!s||!e?c.jsx("div",{className:`flex items-center justify-center aspect-video bg-muted rounded-lg ${n}`,children:c.jsxs("div",{className:"text-center text-muted-foreground",children:[c.jsx("p",{className:"text-lg font-medium",children:"No image to preview"}),c.jsx("p",{className:"text-sm mt-2",children:"Upload an image or start camera to begin"})]})}):c.jsxs("div",{className:`relative ${n}`,children:[c.jsx("canvas",{ref:g,className:"w-full h-auto rounded-lg shadow-lg",style:{display:"block"}}),l&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-sm rounded-lg",children:c.jsx("div",{className:"w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin"})}),o&&c.jsxs("div",{className:"absolute top-4 left-4 right-4 p-4 rounded-lg bg-destructive/90 backdrop-blur-sm flex items-start gap-3",children:[c.jsx(it,{className:"w-5 h-5 text-destructive-foreground flex-shrink-0 mt-0.5"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm font-medium text-destructive-foreground",children:"Rendering Error"}),c.jsx("p",{className:"text-xs text-destructive-foreground/90 mt-1",children:o})]})]}),!f&&!o&&c.jsx("div",{className:"absolute bottom-4 left-4 right-4 p-3 rounded-lg bg-yellow-500/90 backdrop-blur-sm",children:c.jsx("p",{className:"text-xs font-medium text-yellow-950",children:"⚠️ WebGL not available. Using basic rendering mode."})}),p.current>0&&!1]})}function ss(s){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function is(s,e,t){s/=255,e/=255,t/=255;const r=Math.max(s,e,t),n=Math.min(s,e,t);let i=0,o=0;const a=(r+n)/2;if(r!==n){const l=r-n;switch(o=a>.5?l/(2-r-n):l/(r+n),r){case s:i=((e-t)/l+(e<t?6:0))/6;break;case e:i=((t-s)/l+2)/6;break;case t:i=((s-e)/l+4)/6;break}}return{h:i*360,s:o*100,l:a*100}}function I(s,e,t){const r=ss(t),n=is(r.r,r.g,r.b);return{id:s,name:`colors.${s}.name`,category:e,hex:t,rgb:r,hsl:n,description:`colors.${s}.description`}}const os=[I("black","natural","#2C1B0E"),I("dark-brown","natural","#6B4423"),I("chestnut","natural","#8B4513"),I("auburn","natural","#A0522D"),I("light-brown","natural","#B8860B"),I("blonde","natural","#E6B87D"),I("platinum","natural","#F5F5DC"),I("gray","natural","#C0C0C0")],as=[I("red","vibrant","#FF0000"),I("burgundy","vibrant","#8B0000"),I("copper","vibrant","#D2691E"),I("pink","vibrant","#FF1493"),I("purple","vibrant","#9B59B6"),I("blue","vibrant","#3498DB"),I("green","vibrant","#27AE60"),I("turquoise","vibrant","#1ABC9C")],ls=[I("pastel-pink","pastel","#FFB6C1"),I("pastel-purple","pastel","#E0BBE4"),I("pastel-blue","pastel","#AEC6CF"),I("pastel-mint","pastel","#B2E5D4"),I("pastel-peach","pastel","#FFDAB9"),I("rose-gold","pastel","#ECC5C0")],cs=[I("rainbow","fantasy","#FF69B4"),I("galaxy","fantasy","#4B0082"),I("neon-green","fantasy","#39FF14"),I("neon-orange","fantasy","#FF6600"),I("electric-blue","fantasy","#00FFFF")],ds=[...os,...as,...ls,...cs],K=ds,us=s=>s<640?"mobile":s<1024?"tablet":"desktop";function ar(){const[s,e]=x.useState(typeof window<"u"?window.innerWidth:1024);x.useEffect(()=>{const r=()=>{e(window.innerWidth)};let n;const i=()=>{clearTimeout(n),n=setTimeout(r,150)};return window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i),clearTimeout(n)}},[]);const t=us(s);return{breakpoint:t,isMobile:t==="mobile",isTablet:t==="tablet",isDesktop:t==="desktop",isMobileOrTablet:t==="mobile"||t==="tablet",width:s}}const fs=Array.from(new Set(K.map(s=>s.category)));function gs({className:s="",onColorSelect:e}){const{t,ready:r}=ae(),[n,i]=x.useState(""),[o,a]=x.useState(null),{selectedColor:l,setSelectedColor:d}=$(),{isMobile:f}=ar();if(!r)return c.jsx("div",{className:s,children:"Loading..."});const u=K.filter(m=>{if(o&&m.category!==o)return!1;if(n){const y=n.toLowerCase(),C=t(m.name).toLowerCase(),w=m.description?t(m.description).toLowerCase():"";return C.includes(y)||w.includes(y)||m.category.toLowerCase().includes(y)}return!0}),g=m=>{d(m),e?.(m)},h=()=>{i("")},p=()=>{a(null)};return c.jsxs("div",{className:`w-full ${s}`,children:[!f&&c.jsxs("div",{className:"mb-6",children:[c.jsx("h2",{className:"text-2xl font-bold mb-2",children:t("colorPalette.title")}),c.jsx("p",{className:"text-sm text-muted-foreground",children:t("colorPalette.description",{count:K.length})})]}),c.jsxs("div",{className:"relative mb-4",children:[c.jsx(cn,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx("input",{type:"text",placeholder:t("colorPalette.searchPlaceholder"),value:n,onChange:m=>i(m.target.value),className:"w-full pl-10 pr-10 py-2 rounded-lg border border-input bg-background text-sm focus:outline-none focus:ring-2 focus:ring-primary"}),n&&c.jsx("button",{onClick:h,className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:c.jsx(fn,{className:"w-4 h-4"})})]}),c.jsx("div",{className:"mb-6",children:c.jsxs("div",{className:`flex gap-2 ${f?"overflow-x-auto pb-2 -mx-4 px-4 snap-x snap-mandatory":"flex-wrap"}`,children:[c.jsx("button",{onClick:p,className:`${f?"snap-start flex-shrink-0":""} px-4 py-2 rounded-lg text-sm font-medium transition-colors ${o?"bg-muted text-muted-foreground hover:bg-muted/80":"bg-primary text-primary-foreground"} ${f?"min-h-[44px]":""}`,children:t("colorPalette.allColors")}),fs.map(m=>{const y=K.filter(C=>C.category===m).length;return c.jsxs("button",{onClick:()=>a(m),className:`${f?"snap-start flex-shrink-0":""} px-4 py-2 rounded-lg text-sm font-medium transition-colors ${o===m?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"} ${f?"min-h-[44px]":""}`,children:[t(`colorPalette.${m}`)," (",y,")"]},m)})]})}),l&&c.jsx("div",{className:`mb-6 rounded-lg bg-primary/10 border border-primary/20 ${f?"p-3":"p-4"}`,children:c.jsxs("div",{className:`flex items-center ${f?"gap-3":"gap-4"}`,children:[c.jsx("div",{className:`rounded-lg border-2 border-white shadow-lg ${f?"w-12 h-12":"w-16 h-16"}`,style:{backgroundColor:l.hex}}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:`font-semibold truncate ${f?"text-base":"text-lg"}`,children:t(l.name)}),!f&&l.description&&c.jsx("p",{className:"text-sm text-muted-foreground",children:t(l.description)}),c.jsxs("p",{className:"text-muted-foreground mt-1 text-xs",children:[t(`colorPalette.${l.category}`)," • ",l.hex]})]})]})}),c.jsx("div",{className:`grid gap-4 ${f?"grid-cols-2":"grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5"}`,children:u.map(m=>{const y=l?.id===m.id;return c.jsxs("button",{onClick:()=>g(m),className:`
                group relative flex flex-col items-center rounded-lg
                transition-all duration-200
                ${f?"gap-2 p-2 min-h-[120px]":"gap-2 p-3"}
                ${y?"bg-primary/20 border-2 border-primary ring-2 ring-primary/50 scale-105":"bg-muted/50 border border-transparent hover:border-primary/50 hover:bg-muted hover:scale-102"}
              `,children:[c.jsx("div",{className:`
                  w-full aspect-square rounded-lg shadow-md
                  transition-transform duration-200
                  ${y?"scale-105 ring-2 ring-primary":"group-hover:scale-105"}
                `,style:{backgroundColor:m.hex}}),c.jsx("div",{className:"w-full text-center",children:c.jsx("p",{className:`font-medium line-clamp-2 ${f?"text-xs":"text-sm"} ${y?"text-primary":"text-foreground"}`,children:t(m.name)})}),y&&c.jsx("div",{className:`absolute -top-2 -right-2 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold shadow-lg ${f?"w-5 h-5 text-xs":"w-6 h-6 text-xs"}`,children:"✓"})]},m.id)})}),u.length===0&&c.jsxs("div",{className:"text-center py-12",children:[c.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-2",children:t("colorPalette.noResults")}),c.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:t("colorPalette.tryAdjusting")}),c.jsx("button",{onClick:()=>{h(),p()},className:"px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90",children:t("colorPalette.clearFilters")})]}),u.length>0&&u.length<K.length&&c.jsx("div",{className:"mt-4 text-sm text-muted-foreground text-center",children:t("colorPalette.showingCount",{current:u.length,total:K.length})})]})}const hs=Array.from(new Set(K.map(s=>s.category)));function ps({className:s="",onColorSelect:e}){const{t,ready:r}=ae(),[n,i]=x.useState(null),o=x.useRef(null),a=x.useRef(null),{selectedColor:l,setSelectedColor:d}=$();if(!r)return c.jsx("div",{className:s,children:"Loading..."});const f=n?K.filter(h=>h.category===n):K,u=h=>{d(h),e?.(h),typeof window<"u"&&"vibrate"in navigator&&navigator.vibrate(10)},g=h=>{i(h),a.current&&a.current.scrollTo({left:0,behavior:"smooth"})};return x.useEffect(()=>{if(l&&a.current){const h=a.current.querySelectorAll("[data-color-id]"),p=Array.from(h).find(m=>m.getAttribute("data-color-id")===l.id);p&&p.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}},[l]),c.jsxs("div",{className:`w-full bg-white border-t border-border shadow-lg ${s}`,children:[c.jsx("div",{className:"border-b border-border",children:c.jsxs("div",{ref:o,className:"flex gap-1 overflow-x-auto overflow-y-hidden px-4 py-3 scrollbar-hide snap-x snap-mandatory",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:[c.jsxs("button",{onClick:()=>g(null),className:`snap-center flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-all whitespace-nowrap ${n?"bg-muted/50 text-muted-foreground hover:bg-muted":"bg-primary text-primary-foreground shadow-sm scale-105"}`,children:[t("colorPalette.allColors")," (",K.length,")"]}),hs.map(h=>{const p=K.filter(m=>m.category===h).length;return c.jsxs("button",{onClick:()=>g(h),className:`snap-center flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-all whitespace-nowrap ${n===h?"bg-primary text-primary-foreground shadow-sm scale-105":"bg-muted/50 text-muted-foreground hover:bg-muted"}`,children:[t(`colorPalette.${h}`)," (",p,")"]},h)})]})}),c.jsx("div",{ref:a,className:"flex gap-3 overflow-x-auto overflow-y-hidden px-4 py-4 scrollbar-hide snap-x snap-mandatory",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:f.map(h=>{const p=l?.id===h.id;return c.jsxs("button",{"data-color-id":h.id,onClick:()=>u(h),className:`snap-center flex-shrink-0 flex flex-col items-center gap-2 transition-transform duration-200 ${p?"scale-110":"scale-100"}`,children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:`w-16 h-16 rounded-full shadow-md transition-all duration-200 ${p?"ring-4 ring-primary ring-offset-2 ring-offset-white":"ring-2 ring-gray-200"}`,style:{backgroundColor:h.hex}}),p&&c.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold shadow-lg",children:"✓"})]}),c.jsx("div",{className:"text-center max-w-[72px]",children:c.jsx("p",{className:`text-xs font-medium line-clamp-2 ${p?"text-primary":"text-foreground/70"}`,children:t(h.name)})})]},h.id)})}),l&&c.jsx("div",{className:"border-t border-border bg-primary/5 px-4 py-2",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-8 h-8 rounded-full shadow-sm border-2 border-white flex-shrink-0",style:{backgroundColor:l.hex}}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:t(l.name)}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:[t(`colorPalette.${l.category}`)," • ",l.hex]})]})]})}),c.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `})]})}function Bt(){const{t:s,ready:e}=ae(),t=ir(),r=$(o=>o.setSegmentationMethod);if(!e)return null;const n=[{id:"modnet",name:s("segmentation.aiSegmentation")||"AI Segmentation",description:s("segmentation.aiDescription")||"Fast browser-based processing",icon:un,badge:s("segmentation.recommended")||"Recommended",disabled:!1},{id:"server",name:s("segmentation.serverSide")||"Server-side",description:s("segmentation.serverDescription")||"Cloud processing for highest quality",icon:dn,badge:s("segmentation.comingSoon")||"Coming Soon",disabled:!0}].filter(o=>(o.id,!0)),i=o=>{if(o==="server"){console.log("Server-side segmentation coming soon!");return}r(o)};return c.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[c.jsxs("div",{className:"mb-6",children:[c.jsx("h2",{className:"text-xl font-semibold mb-2",children:s("segmentation.title")}),c.jsx("p",{className:"text-sm text-muted-foreground",children:s("segmentation.description")})]}),c.jsx("div",{className:"space-y-3",children:n.map(o=>{const a=o.icon,l=t===o.id,d=o.disabled;return c.jsx("button",{onClick:()=>i(o.id),disabled:d,className:`
                w-full text-left p-4 rounded-lg border-2 transition-all
                ${l?"border-primary bg-primary/5":d?"border-gray-200 bg-gray-50 opacity-60 cursor-not-allowed":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}
              `,children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:`
                    p-2 rounded-lg
                    ${l?"bg-primary text-primary-foreground":d?"bg-gray-200 text-gray-400":"bg-muted text-muted-foreground"}
                  `,children:c.jsx(a,{className:"w-5 h-5"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("h3",{className:`font-semibold ${d?"text-gray-400":""}`,children:o.name}),o.badge&&c.jsx("span",{className:`
                          text-xs px-2 py-0.5 rounded-full font-medium
                          ${d?"bg-gray-200 text-gray-500":l?"bg-primary/20 text-primary":"bg-muted text-muted-foreground"}
                        `,children:o.badge})]}),c.jsx("p",{className:`text-sm ${d?"text-gray-400":"text-muted-foreground"}`,children:o.description})]}),l&&!d&&c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-5 h-5 rounded-full bg-primary flex items-center justify-center",children:c.jsx("svg",{className:"w-3 h-3 text-primary-foreground",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})})]})},o.id)})})]})}const Ht=[{code:"zh-CN",name:"Simplified Chinese",nativeName:"简体中文"},{code:"en",name:"English",nativeName:"English"}];function ms(){const{i18n:s}=ae(),e=Wn(),t=$(i=>i.setLanguage),r=i=>{t(i),s.changeLanguage(i)},n=Ht.find(i=>i.code===e);return c.jsxs("div",{className:"relative group",children:[c.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-muted transition-colors","aria-label":"Select language",children:[c.jsx(ln,{className:"w-5 h-5"}),c.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:n?.nativeName})]}),c.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50",children:c.jsx("div",{className:"py-1",children:Ht.map(i=>c.jsxs("button",{onClick:()=>r(i.code),className:`w-full text-left px-4 py-2 hover:bg-muted transition-colors flex items-center justify-between ${e===i.code?"bg-primary/10 text-primary":""}`,children:[c.jsx("span",{className:"text-sm font-medium",children:i.nativeName}),e===i.code&&c.jsx("span",{className:"text-primary text-lg",children:"✓"})]},i.code))})})]})}function xs(){const{t:s}=ae(),[e,t]=x.useState("upload"),{isMobile:r,isTablet:n}=ar(),i=$(p=>p.currentImage),o=$(p=>p.currentMask),a=$(p=>p.selectedColor),l=$(p=>p.segmentationMethod),d=$(p=>p.setCurrentImage),f=$(p=>p.setCurrentMask),u=$(p=>p.setSegmentationStatus);x.useEffect(()=>{const p=async()=>{console.log("[App] Loading demo image...");try{const m=new Image;m.src="/virtualtryon/demo.png",await new Promise((C,w)=>{m.onload=C,m.onerror=w}),console.log("[App] Demo image loaded successfully:",m.naturalWidth,"x",m.naturalHeight),d({element:m,url:"/virtualtryon/demo.png",width:m.naturalWidth,height:m.naturalHeight,source:"upload"}),console.log("[App] Initializing segmentation orchestrator with method:",l),u("loading"),await Z.initialize(l),console.log("[App] Segmenting demo image..."),u("segmenting");const y=await Z.segment(m,l);console.log("[App] Segmentation complete. Mask size:",y.width,"x",y.height),f({data:y.mask,width:y.width,height:y.height,confidence:y.confidence,source:"ai"}),u("ready"),console.log("[App] Demo image setup complete!")}catch(m){console.error("[App] Failed to load demo image:",m),u("error")}};i?console.log("[App] Current image already exists, skipping demo load"):(console.log("[App] No current image found, loading demo image"),p())},[]);const g=()=>{const p=document.querySelector("canvas");if(!p)return;const m=document.createElement("a");m.download=`hair-color-${a?.name||"preview"}-${Date.now()}.jpg`,m.href=p.toDataURL("image/jpeg",.9),m.click()},h=i&&o&&a;return c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:[c.jsx("header",{className:"bg-white/95 backdrop-blur-md shadow-sm sticky top-0 z-40 safe-top",children:c.jsx("div",{className:"container mx-auto px-4 py-3 md:py-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h1",{className:`font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent ${r?"text-lg":"text-2xl md:text-3xl"}`,children:s(r?"app.titleMobile":"app.title")}),!r&&c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("app.subtitle")})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ms,{}),h&&c.jsxs("button",{onClick:g,className:`flex items-center justify-center gap-2 rounded-lg font-medium bg-green-600 text-white hover:bg-green-700 transition-colors ${r?"w-11 h-11":"px-4 py-2"}`,"aria-label":"Download colored photo",children:[c.jsx(an,{className:"w-5 h-5"}),!r&&c.jsx("span",{children:s("header.download")})]})]})]})})}),c.jsxs("div",{className:`container mx-auto px-4 py-8 ${r||n?"pb-64":""}`,children:[c.jsx("div",{className:"flex justify-center mb-6 md:mb-8",children:c.jsxs("div",{className:`inline-flex rounded-lg bg-white shadow-md p-1 ${r?"w-full max-w-md":""}`,children:[c.jsxs("button",{onClick:()=>t("upload"),className:`flex items-center justify-center gap-2 rounded-md font-medium transition-all ${r?"flex-1 py-3 px-4":"px-6 py-3"} ${e==="upload"?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:[c.jsx(Zt,{className:"w-5 h-5"}),c.jsx("span",{className:r?"text-sm":"",children:s("modes.upload")})]}),c.jsxs("button",{onClick:()=>t("camera"),className:`flex items-center justify-center gap-2 rounded-md font-medium transition-all ${r?"flex-1 py-3 px-4":"px-6 py-3"} ${e==="camera"?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:[c.jsx(Xe,{className:"w-5 h-5"}),c.jsx("span",{className:r?"text-sm":"",children:s("modes.camera")})]})]})}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[c.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[(r||n)&&c.jsx("div",{children:c.jsx(Bt,{})}),c.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e==="upload"?c.jsx(Je,{className:"w-6 h-6 text-primary"}):c.jsx(Xe,{className:"w-6 h-6 text-primary"}),c.jsx("h2",{className:"text-2xl font-semibold",children:s(e==="upload"?"upload.title":"camera.title")})]}),e==="upload"?c.jsx(Xn,{}):c.jsx(Qn,{applyColor:!0})]}),h&&c.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsx("h2",{className:"text-2xl font-semibold",children:s("preview.title")}),c.jsx("div",{className:"px-3 py-1 rounded-lg bg-primary/10 text-primary text-sm font-medium",children:s(a.name)})]}),c.jsx(ns,{sourceImage:i.element,hairMask:o.data,maskWidth:o.width,maskHeight:o.height})]}),!h&&c.jsx("div",{className:"bg-white rounded-xl shadow-lg p-12",children:c.jsxs("div",{className:"text-center text-muted-foreground",children:[c.jsx(Je,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),c.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("preview.noPreview")}),c.jsx("p",{className:"text-sm",children:s(e==="upload"?"preview.noPreviewUpload":"preview.noPreviewCamera")})]})})]}),!r&&!n&&c.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[c.jsx("div",{className:"sticky top-24",children:c.jsx(Bt,{})}),c.jsx("div",{className:"sticky top-24",children:c.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:c.jsx(gs,{})})})]})]}),(r||n)&&c.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-30 pb-safe-bottom",children:c.jsx(ps,{})}),c.jsx("footer",{className:"mt-16 text-center text-sm text-muted-foreground",children:c.jsxs("p",{children:[s("footer.copyrightPrefix")," ",c.jsx("a",{href:"https://www.shiftrightlabs.com/",target:"_blank",rel:"noopener noreferrer",className:"hover:text-primary transition-colors font-medium",children:s("footer.companyName")}),". ",s("footer.copyrightSuffix")]})})]})]})}const ys={title:"虚拟染发试色",titleMobile:"染发试色",subtitle:""},bs={colors:"选色",download:"下载"},vs={upload:"上传照片",camera:"实时摄像"},ws={title:"上传您的照片",dropHere:"拖放图片到这里",uploadYourPhoto:"上传您的照片",dragAndDrop:"拖放或点击浏览",supported:"支持格式：JPG、PNG、WebP（最大 10MB）",processing:"正在处理图片...",detecting:"正在检测头发区域...",loadingModel:"正在加载 AI 模型...",pleaseWait:"请稍候...",uploaded:"图片已上传！",uploadDifferent:"点击上传其他照片",error:"错误",invalidFileType:"文件格式无效。请上传 JPG、JPEG、PNG、WEBP 格式的文件。",fileTooLarge:"文件过大（{{size}}MB）。最大文件大小为 10MB。",failedToLoad:"图片加载失败。文件可能已损坏。",failedToRead:"文件读取失败。请重试。",requirements:"最佳效果建议：",clearPhoto:"清晰明亮的照片",hairVisible:"头发完全可见",frontFacing:"正面或四分之三侧面角度",plainBackground:"建议使用纯色背景"},Ss={title:"实时摄像预览"},Cs={title:"预览",confidence:"",rendering:"",noPreview:"暂无预览",noPreviewUpload:"上传照片并选择颜色以查看预览",noPreviewCamera:"启动摄像头并选择颜色以查看预览"},Ns={title:"选择您的颜色",description:"选择一个发色进行预览。共有 {{count}} 种颜色可选。",searchPlaceholder:"搜索颜色...",allColors:"全部颜色",natural:"自然色",vibrant:"鲜艳色",pastel:"柔和色",fantasy:"幻彩色",noResults:"未找到颜色",tryAdjusting:"尝试调整搜索或分类筛选",clearFilters:"清除筛选",showingCount:"显示 {{current}} / {{total}} 种颜色"},Rs={title:"处理模式",description:"选择处理模式以获得最佳效果",aiSegmentation:"客户端处理",aiDescription:"快速、隐私优先的浏览器内处理。",serverSide:"服务器端",serverDescription:"云端处理以获得最高质量。",recommended:"推荐",comingSoon:"即将推出",howItWorks:"",howItWorksText:""},ks={copyrightPrefix:"© 2025",companyName:"Shift Right Labs",copyrightSuffix:"版权所有"},Es={name:"简体中文",switchTo:"切换至{{language}}"},Ls={black:{name:"黑色",description:"深邃浓郁的黑色，适合打造戏剧效果"},"dark-brown":{name:"深棕色",description:"经典深棕色，适合所有人"},chestnut:{name:"栗色",description:"温暖的栗棕色，带有红色底色"},auburn:{name:"赤褐色",description:"浓郁的赤褐色，带有自然红色高光"},"light-brown":{name:"浅棕色",description:"柔和的浅棕色，带有金色色调"},blonde:{name:"金色",description:"经典金发色，温暖明亮"},platinum:{name:"铂金色",description:"超浅铂金发色"},gray:{name:"银灰色",description:"优雅的银灰色"},red:{name:"鲜红色",description:"大胆火热的红色，适合个性造型"},burgundy:{name:"酒红色",description:"深邃的酒红色"},copper:{name:"铜色",description:"明亮的铜橙色"},pink:{name:"热粉色",description:"炫亮的热粉色"},purple:{name:"紫色",description:"浓郁的紫罗兰色"},blue:{name:"蓝色",description:"明亮的天蓝色"},green:{name:"绿色",description:"生动的翡翠绿色"},turquoise:{name:"青绿色",description:"明亮的青绿蓝色"},"pastel-pink":{name:"柔粉色",description:"柔和梦幻的粉色"},"pastel-purple":{name:"柔紫色",description:"精致的薰衣草紫色"},"pastel-blue":{name:"柔蓝色",description:"浅天蓝色"},"pastel-mint":{name:"薄荷绿",description:"清新的薄荷绿色"},"pastel-peach":{name:"柔桃色",description:"柔和的桃珊瑚色"},"rose-gold":{name:"玫瑰金",description:"时尚的玫瑰金混合色"},rainbow:{name:"彩虹色",description:"多彩彩虹效果（基色：热粉色）"},galaxy:{name:"星系色",description:"深邃的太空紫蓝混合色"},"neon-green":{name:"荧光绿",description:"电光荧光绿色"},"neon-orange":{name:"荧光橙",description:"明亮的荧光橙色"},"electric-blue":{name:"电光蓝",description:"明亮的电光青色"}},js={app:ys,header:bs,modes:vs,upload:ws,camera:Ss,preview:Cs,colorPalette:Ns,segmentation:Rs,footer:ks,language:Es,colors:Ls},Ps={title:"VIRTUAL HAIR COLOR TRY ON",titleMobile:"Hair Color Try On",subtitle:""},_s={colors:"Colors",download:"Download"},Os={upload:"Upload Photo",camera:"Live Camera"},Ts={title:"Upload Your Photo",dropHere:"Drop image here",uploadYourPhoto:"Upload your photo",dragAndDrop:"Drag and drop or click to browse",supported:"Supported: JPG, PNG, WebP (max 10MB)",processing:"Processing image...",detecting:"Detecting hair areas...",loadingModel:"Loading AI model...",pleaseWait:"Please wait...",uploaded:"Image uploaded!",uploadDifferent:"Click to upload a different photo",error:"Error",invalidFileType:"Invalid file type. Please upload JPG, JPEG, PNG, WEBP files only.",fileTooLarge:"File too large ({{size}}MB). Maximum size is 10MB.",failedToLoad:"Failed to load image. File may be corrupted.",failedToRead:"Failed to read file. Please try again.",requirements:"Requirements for best results:",clearPhoto:"Clear, well-lit photo",hairVisible:"Hair fully visible",frontFacing:"Front-facing or 3/4 angle",plainBackground:"Plain background recommended"},Fs={title:"Live Camera Preview"},Is={title:"Preview",confidence:"",rendering:"",noPreview:"No Preview Yet",noPreviewUpload:"Upload a photo and select a color to see the preview",noPreviewCamera:"Start the camera and select a color to see the preview"},As={title:"Choose Your Color",description:"Select a hair color to preview. {{count}} colors available.",searchPlaceholder:"Search colors...",allColors:"All Colors",natural:"Natural",vibrant:"Vibrant",pastel:"Pastel",fantasy:"Fantasy",noResults:"No colors found",tryAdjusting:"Try adjusting your search or category filter",clearFilters:"Clear Filters",showingCount:"Showing {{current}} of {{total}} colors"},Ms={title:"Processing Mode",description:"Select processing mode for best results",aiSegmentation:"Client-Side",aiDescription:"Fast, privacy-first processing in your browser.",serverSide:"Server-Side",serverDescription:"Cloud processing for maximum quality.",recommended:"Recommended",comingSoon:"Coming Soon",howItWorks:"",howItWorksText:""},Ds={copyrightPrefix:"© 2025",companyName:"Shift Right Labs",copyrightSuffix:"All rights reserved."},$s={name:"English",switchTo:"Switch to {{language}}"},zs={black:{name:"Black",description:"Deep, rich black for dramatic looks"},"dark-brown":{name:"Dark Brown",description:"Classic dark brown, universally flattering"},chestnut:{name:"Chestnut",description:"Warm chestnut brown with red undertones"},auburn:{name:"Auburn",description:"Rich auburn with natural red highlights"},"light-brown":{name:"Light Brown",description:"Soft, light brown with golden tones"},blonde:{name:"Blonde",description:"Classic blonde, warm and luminous"},platinum:{name:"Platinum Blonde",description:"Ultra-light platinum blonde"},gray:{name:"Silver Gray",description:"Elegant silver gray"},red:{name:"Vibrant Red",description:"Bold, fiery red for statement looks"},burgundy:{name:"Burgundy",description:"Deep burgundy red"},copper:{name:"Copper",description:"Bright copper orange"},pink:{name:"Hot Pink",description:"Electric hot pink"},purple:{name:"Purple",description:"Rich purple violet"},blue:{name:"Blue",description:"Bright sky blue"},green:{name:"Green",description:"Vivid emerald green"},turquoise:{name:"Turquoise",description:"Bright turquoise blue"},"pastel-pink":{name:"Pastel Pink",description:"Soft, dreamy pink"},"pastel-purple":{name:"Pastel Purple",description:"Delicate lavender purple"},"pastel-blue":{name:"Pastel Blue",description:"Light sky blue"},"pastel-mint":{name:"Mint Green",description:"Fresh mint green"},"pastel-peach":{name:"Pastel Peach",description:"Soft peachy coral"},"rose-gold":{name:"Rose Gold",description:"Trendy rose gold blend"},rainbow:{name:"Rainbow",description:"Multi-color rainbow effect (base: hot pink)"},galaxy:{name:"Galaxy",description:"Deep space purple-blue blend"},"neon-green":{name:"Neon Green",description:"Electric neon green"},"neon-orange":{name:"Neon Orange",description:"Bright neon orange"},"electric-blue":{name:"Electric Blue",description:"Bright electric cyan"}},Us={app:Ps,header:_s,modes:Os,upload:Ts,camera:Fs,preview:Is,colorPalette:As,segmentation:Ms,footer:Ds,language:$s,colors:zs},Bs=()=>{try{return typeof window<"u"&&window.localStorage?localStorage.getItem("language"):null}catch{return console.warn("localStorage not available, using default language"),null}};U.use(qr).init({resources:{"zh-CN":{translation:js},en:{translation:Us}},lng:Bs()||"zh-CN",fallbackLng:"zh-CN",interpolation:{escapeValue:!1},react:{useSuspense:!1}});mr.createRoot(document.getElementById("root")).render(c.jsx(ge.StrictMode,{children:c.jsx(xs,{})}));
